<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Volante Financeiro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        .logo-animation {
            animation: rotate 3s linear infinite;
        }
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Tela de Login -->
    <div id="loginScreen" class="min-h-screen gradient-bg flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md fade-in">
            <!-- Logo -->
            <div class="text-center mb-8">
                <div class="inline-block relative">
                    <div class="w-20 h-20 mx-auto mb-4 bg-green-600 rounded-full flex items-center justify-center logo-animation">
                        <svg class="w-12 h-12 text-white" viewBox="0 0 24 24" fill="currentColor">
                            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none"/>
                            <circle cx="12" cy="12" r="6" stroke="currentColor" stroke-width="1" fill="none"/>
                            <text x="12" y="16" text-anchor="middle" class="text-xs font-bold fill-current">$</text>
                        </svg>
                    </div>
                </div>
                <h1 class="text-2xl font-bold text-green-800 mb-2">Volante Financeiro</h1>
                <p class="text-sm text-gray-600">Desenvolvido por Escola Estadual Dr. Jo√£o Leite de Barros</p>
            </div>

            <!-- Formul√°rio de Login -->
            <form id="loginForm" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">CPF</label>
                    <input type="text" id="loginCpf" placeholder="000.000.000-00" 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-300">
                    <div id="cpfValidationMessage" class="mt-1 text-sm hidden"></div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Senha</label>
                    <input type="password" id="loginPassword" placeholder="Digite sua senha"
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                </div>
                
                <div class="flex items-center mb-4">
                    <input type="checkbox" id="rememberLogin" class="mr-2 rounded">
                    <label for="rememberLogin" class="text-sm text-gray-600">Lembrar meus dados</label>
                </div>
                
                <button type="submit" class="w-full bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700 transition duration-200">
                    Entrar
                </button>
            </form>

            <div class="mt-6 space-y-3">
                <button onclick="showRegister()" class="w-full bg-gray-100 text-green-700 py-3 rounded-lg font-semibold hover:bg-gray-200 transition duration-200">
                    Cadastrar Nova Conta
                </button>
                <button onclick="showPasswordReset()" class="w-full text-green-600 hover:text-green-800 text-sm">
                    Esqueci minha senha
                </button>
                <div class="relative my-4">
                    <div class="absolute inset-0 flex items-center">
                        <div class="w-full border-t border-gray-300"></div>
                    </div>
                    <div class="relative flex justify-center text-sm">
                        <span class="px-2 bg-white text-gray-500">ou</span>
                    </div>
                </div>
                
                <button onclick="handleTestLogin()" class="w-full bg-purple-600 text-white py-3 rounded-lg font-semibold hover:bg-purple-700 transition duration-200 flex items-center justify-center space-x-2">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                    </svg>
                    <span>Teste Gr√°tis (7 dias)</span>
                </button>
                
                <button onclick="showAdminLogin()" class="w-full text-gray-500 hover:text-gray-700 text-xs">
                    Acesso Administrador
                </button>
            </div>
        </div>
    </div>

    <!-- Tela de Cadastro -->
    <div id="registerScreen" class="hidden min-h-screen gradient-bg flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md fade-in">
            <div class="text-center mb-6">
                <h2 class="text-2xl font-bold text-green-800">Novo Cadastro</h2>
                <p class="text-gray-600">Preencha seus dados</p>
            </div>

            <form id="registerForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Nome Completo</label>
                    <input type="text" id="regName" required
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">CPF</label>
                    <input type="text" id="regCpf" placeholder="000.000.000-00" required
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Idade</label>
                    <input type="number" id="regAge" min="18" max="80" required
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                    <input type="email" id="regEmail" required
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">WhatsApp</label>
                    <input type="tel" id="regWhatsapp" placeholder="(67) 99999-9999" required
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Senha</label>
                    <input type="password" id="regPassword" required
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Plataforma Principal</label>
                    <select id="regPlatform" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                        <option value="">Selecione...</option>
                        <option value="BR Car">BR Car</option>
                        <option value="IBolt">IBolt</option>
                        <option value="Ifood">Ifood</option>
                        <option value="InDriver">InDriver</option>
                        <option value="Uber">Uber</option>
                        <option value="T√¥ Aqui">T√¥ Aqui</option>
                        <option value="Taxi-Connect">Taxi-Connect</option>
                        <option value="Urban">Urban</option>
                        <option value="Outros">Outros</option>
                    </select>
                </div>

                <button type="submit" class="w-full bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700">
                    Cadastrar
                </button>
            </form>

            <button onclick="showLogin()" class="w-full mt-4 text-green-600 hover:text-green-800">
                Voltar ao Login
            </button>
        </div>
    </div>

    <!-- Tela de Recupera√ß√£o de Senha -->
    <div id="passwordResetScreen" class="hidden min-h-screen gradient-bg flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md fade-in">
            <div class="text-center mb-6">
                <h2 class="text-2xl font-bold text-green-800">Recuperar Senha</h2>
                <p class="text-gray-600">Digite seu email cadastrado</p>
            </div>

            <form id="resetForm" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                    <input type="email" id="resetEmail" required
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                </div>
                
                <button type="submit" class="w-full bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700">
                    Enviar Nova Senha
                </button>
            </form>

            <button onclick="showLogin()" class="w-full mt-4 text-green-600 hover:text-green-800">
                Voltar ao Login
            </button>
        </div>
    </div>

    <!-- Login Administrador -->
    <div id="adminLoginScreen" class="hidden min-h-screen gradient-bg flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md fade-in">
            <div class="text-center mb-6">
                <h2 class="text-2xl font-bold text-red-600">Acesso Administrador</h2>
                <p class="text-gray-600">√Årea restrita</p>
            </div>

            <form id="adminLoginForm" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Usu√°rio</label>
                    <input type="text" id="adminUser" value="desenvolvedor" readonly
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-100">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Senha</label>
                    <input type="password" id="adminPassword" placeholder="Digite a senha de administrador"
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500">
                </div>
                
                <button type="submit" class="w-full bg-red-600 text-white py-3 rounded-lg font-semibold hover:bg-red-700">
                    Entrar como Admin
                </button>
            </form>

            <button onclick="showLogin()" class="w-full mt-4 text-green-600 hover:text-green-800">
                Voltar ao Login
            </button>
        </div>
    </div>

    <!-- Dashboard Principal -->
    <div id="dashboardScreen" class="hidden min-h-screen bg-gray-50 flex flex-col">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b">
            <div class="px-4 py-4 flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-green-600 rounded-full flex items-center justify-center" id="appLogoDisplay">
                        <span class="text-white font-bold">$</span>
                    </div>
                    <div>
                        <h1 class="font-bold text-green-800">Volante Financeiro</h1>
                        <p class="text-xs text-gray-500" id="userWelcome">Bem-vindo!</p>
                    </div>
                </div>
                <button onclick="logout()" class="text-red-600 hover:text-red-800 text-sm">
                    Sair
                </button>
            </div>
        </header>

        <!-- Navega√ß√£o -->
        <nav class="bg-white border-b">
            <div class="flex overflow-x-auto">
                <button onclick="showTab('dashboard')" class="tab-btn px-6 py-3 text-sm font-medium border-b-2 border-green-600 text-green-600">
                    üìä Dashboard
                </button>
                <button onclick="showTab('earnings')" class="tab-btn px-6 py-3 text-sm font-medium text-gray-500 hover:text-green-600">
                    üí∞ Ganhos
                </button>
                <button onclick="showTab('expenses')" class="tab-btn px-6 py-3 text-sm font-medium text-gray-500 hover:text-green-600">
                    üí∏ Despesas
                </button>
                <button onclick="showTab('savings')" class="tab-btn px-6 py-3 text-sm font-medium text-gray-500 hover:text-green-600">
                    üè¶ Cofres
                </button>
                <button onclick="showTab('analytics')" class="tab-btn px-6 py-3 text-sm font-medium text-gray-500 hover:text-green-600">
                    üìà An√°lises
                </button>
                <button onclick="showTab('goals')" class="tab-btn px-6 py-3 text-sm font-medium text-gray-500 hover:text-green-600">
                    üéØ Metas
                </button>
                <button onclick="showTab('supporters')" class="tab-btn px-6 py-3 text-sm font-medium text-gray-500 hover:text-green-600">
                    ü§ù Apoiadores
                </button>
                <button onclick="showTab('about')" class="tab-btn px-6 py-3 text-sm font-medium text-gray-500 hover:text-green-600">
                    ‚ÑπÔ∏è Sobre
                </button>
                <button onclick="showTab('export')" class="tab-btn px-6 py-3 text-sm font-medium text-gray-500 hover:text-green-600">
                    üì§ Exportar
                </button>
            </div>
        </nav>

        <!-- Sistema de Notifica√ß√µes -->
        <div id="notificationContainer" class="fixed top-4 right-4 z-50 space-y-2">
            <!-- Notifica√ß√µes aparecer√£o aqui -->
        </div>

        <!-- Conte√∫do das Abas -->
        <div class="p-4">
            <!-- Aba Dashboard Principal -->
            <div id="dashboardTab" class="tab-content">
                <!-- Cards de Resumo -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                    <!-- Card Ganhos -->
                    <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-6 text-white shadow-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-green-100 text-sm">Total Ganhos</p>
                                <p class="text-2xl font-bold" id="dashTotalEarnings">R$ 0,00</p>
                                <p class="text-green-100 text-xs" id="dashEarningsCount">0 registros</p>
                            </div>
                            <div class="bg-white bg-opacity-20 rounded-full p-3">
                                <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M4 4a2 2 0 00-2 2v4a2 2 0 002 2V6h10a2 2 0 00-2-2H4zm2 6a2 2 0 012-2h8a2 2 0 012 2v4a2 2 0 01-2 2H8a2 2 0 01-2-2v-4zm6 4a2 2 0 100-4 2 2 0 000 4z"/>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <!-- Card Despesas -->
                    <div class="bg-gradient-to-br from-red-500 to-red-600 rounded-xl p-6 text-white shadow-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-red-100 text-sm">Total Despesas</p>
                                <p class="text-2xl font-bold" id="dashTotalExpenses">R$ 0,00</p>
                                <p class="text-red-100 text-xs" id="dashExpensesCount">0 registros</p>
                            </div>
                            <div class="bg-white bg-opacity-20 rounded-full p-3">
                                <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z"/>
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <!-- Card Cofres -->
                    <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-6 text-white shadow-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-blue-100 text-sm">Total em Cofres</p>
                                <p class="text-2xl font-bold" id="dashTotalSavings">R$ 0,00</p>
                                <p class="text-blue-100 text-xs" id="dashSavingsCount">0 cofres</p>
                            </div>
                            <div class="bg-white bg-opacity-20 rounded-full p-3">
                                <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4z"/>
                                    <path fill-rule="evenodd" d="M18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <!-- Card Saldo Dispon√≠vel -->
                    <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl p-6 text-white shadow-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-purple-100 text-sm">Saldo Dispon√≠vel</p>
                                <p class="text-2xl font-bold" id="dashAvailableBalance">R$ 0,00</p>
                                <p class="text-purple-100 text-xs">Para usar ou guardar</p>
                            </div>
                            <div class="bg-white bg-opacity-20 rounded-full p-3">
                                <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.293l-3-3a1 1 0 00-1.414 0l-3 3a1 1 0 001.414 1.414L9 9.414V13a1 1 0 102 0V9.414l1.293 1.293a1 1 0 001.414-1.414z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gr√°fico e Atividades Recentes -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <!-- Gr√°fico de Vis√£o Geral -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-semibold mb-4">üìä Vis√£o Geral - Este M√™s</h3>
                        <div class="relative h-64">
                            <canvas id="dashboardChart"></canvas>
                        </div>
                    </div>

                    <!-- Atividades Recentes -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-semibold mb-4">üïí Atividades Recentes</h3>
                        <div id="recentActivities" class="space-y-3 max-h-64 overflow-y-auto">
                            <!-- Atividades ser√£o carregadas aqui -->
                        </div>
                    </div>
                </div>

                <!-- Metas e Plataformas -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Metas em Progresso -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold">üéØ Metas em Progresso</h3>
                            <button onclick="showTab('goals')" class="text-purple-600 hover:text-purple-800 text-sm">
                                Ver todas ‚Üí
                            </button>
                        </div>
                        <div id="dashGoalsProgress" class="space-y-3">
                            <!-- Metas ser√£o carregadas aqui -->
                        </div>
                    </div>

                    <!-- Ganhos por Plataforma -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold">üöó Ganhos por Plataforma</h3>
                            <button onclick="showTab('earnings')" class="text-green-600 hover:text-green-800 text-sm">
                                Ver detalhes ‚Üí
                            </button>
                        </div>
                        <div id="dashPlatformEarnings" class="space-y-3">
                            <!-- Plataformas ser√£o carregadas aqui -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Aba Ganhos -->
            <div id="earningsTab" class="tab-content">
                <div class="bg-white rounded-lg shadow p-6 mb-6">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">Registrar Ganho</h2>
                    <form id="earningsForm" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Plataforma</label>
                                <select id="earningPlatform" class="w-full px-3 py-2 border rounded-lg">
                                    <option value="BR Car">BR Car</option>
                                    <option value="IBolt">IBolt</option>
                                    <option value="Ifood">Ifood</option>
                                    <option value="InDriver">InDriver</option>
                                    <option value="Uber">Uber</option>
                                    <option value="T√¥ Aqui">T√¥ Aqui</option>
                                    <option value="Taxi-Connect">Taxi-Connect</option>
                                    <option value="Urban">Urban</option>
                                    <option value="Outros">Outros</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Valor (R$)</label>
                                <input type="number" id="earningAmount" step="0.01" min="0" 
                                       class="w-full px-3 py-2 border rounded-lg">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Data</label>
                                <input type="date" id="earningDate" 
                                       class="w-full px-3 py-2 border rounded-lg">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Tipo</label>
                                <select id="earningType" class="w-full px-3 py-2 border rounded-lg">
                                    <option value="Corrida">Corrida</option>
                                    <option value="Entrega">Entrega</option>
                                    <option value="Gorjeta">Gorjeta</option>
                                </select>
                            </div>
                        </div>
                        <button type="submit" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700">
                            Adicionar Ganho
                        </button>
                    </form>
                </div>

                <!-- Lista de Ganhos -->
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold">Ganhos Recentes</h3>
                        <div class="flex space-x-2">
                            <input type="text" id="searchEarnings" placeholder="üîç Buscar ganhos..." 
                                   class="px-3 py-1 border rounded-lg text-sm w-40 focus:ring-2 focus:ring-green-500">
                            <select id="filterEarningsPlatform" class="px-3 py-1 border rounded-lg text-sm focus:ring-2 focus:ring-green-500">
                                <option value="">Todas as plataformas</option>
                                <option value="BR Car">BR Car</option>
                                <option value="IBolt">IBolt</option>
                                <option value="Ifood">Ifood</option>
                                <option value="InDriver">InDriver</option>
                                <option value="Uber">Uber</option>
                                <option value="T√¥ Aqui">T√¥ Aqui</option>
                                <option value="Taxi-Connect">Taxi-Connect</option>
                                <option value="Urban">Urban</option>
                                <option value="Outros">Outros</option>
                            </select>
                        </div>
                    </div>
                    <div id="earningsList" class="space-y-3">
                        <!-- Ganhos ser√£o listados aqui -->
                    </div>
                </div>
            </div>

            <!-- Aba Despesas -->
            <div id="expensesTab" class="tab-content hidden">
                <div class="bg-white rounded-lg shadow p-6 mb-6">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">Registrar Despesa</h2>
                    <form id="expensesForm" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Categoria</label>
                                <select id="expenseCategory" class="w-full px-3 py-2 border rounded-lg">
                                    <option value="Combust√≠vel">Combust√≠vel</option>
                                    <option value="Manuten√ß√£o">Manuten√ß√£o</option>
                                    <option value="Documenta√ß√£o">Documenta√ß√£o</option>
                                    <option value="Alimenta√ß√£o">Alimenta√ß√£o</option>
                                    <option value="Seguro">Seguro</option>
                                    <option value="IPVA">IPVA</option>
                                    <option value="Licenciamento">Licenciamento</option>
                                    <option value="Multas">Multas</option>
                                    <option value="Estacionamento">Estacionamento</option>
                                    <option value="Lavagem">Lavagem do Ve√≠culo</option>
                                    <option value="Pneus">Pneus</option>
                                    <option value="√ìleo">√ìleo e Filtros</option>
                                    <option value="Pe√ßas">Pe√ßas e Acess√≥rios</option>
                                    <option value="Telefone">Telefone/Internet</option>
                                    <option value="Outros">Outros</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Valor (R$)</label>
                                <input type="number" id="expenseAmount" step="0.01" min="0" 
                                       class="w-full px-3 py-2 border rounded-lg">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Data</label>
                                <input type="date" id="expenseDate" 
                                       class="w-full px-3 py-2 border rounded-lg">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Descri√ß√£o</label>
                                <input type="text" id="expenseDescription" placeholder="Descri√ß√£o opcional"
                                       class="w-full px-3 py-2 border rounded-lg">
                            </div>
                        </div>
                        <button type="submit" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700">
                            Adicionar Despesa
                        </button>
                    </form>
                </div>

                <!-- Lista de Despesas -->
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold">Despesas Recentes</h3>
                        <div class="flex space-x-2">
                            <input type="text" id="searchExpenses" placeholder="üîç Buscar despesas..." 
                                   class="px-3 py-1 border rounded-lg text-sm w-40 focus:ring-2 focus:ring-red-500">
                            <select id="filterExpensesCategory" class="px-3 py-1 border rounded-lg text-sm focus:ring-2 focus:ring-red-500">
                                <option value="">Todas as categorias</option>
                                <option value="Combust√≠vel">Combust√≠vel</option>
                                <option value="Manuten√ß√£o">Manuten√ß√£o</option>
                                <option value="Documenta√ß√£o">Documenta√ß√£o</option>
                                <option value="Alimenta√ß√£o">Alimenta√ß√£o</option>
                                <option value="Seguro">Seguro</option>
                                <option value="IPVA">IPVA</option>
                                <option value="Licenciamento">Licenciamento</option>
                                <option value="Multas">Multas</option>
                                <option value="Estacionamento">Estacionamento</option>
                                <option value="Lavagem">Lavagem do Ve√≠culo</option>
                                <option value="Pneus">Pneus</option>
                                <option value="√ìleo">√ìleo e Filtros</option>
                                <option value="Pe√ßas">Pe√ßas e Acess√≥rios</option>
                                <option value="Telefone">Telefone/Internet</option>
                                <option value="Outros">Outros</option>
                            </select>
                        </div>
                    </div>
                    <div id="expensesList" class="space-y-3">
                        <!-- Despesas ser√£o listadas aqui -->
                    </div>
                </div>
            </div>

            <!-- Aba Cofres -->
            <div id="savingsTab" class="tab-content hidden">
                <div class="bg-white rounded-lg shadow p-6 mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-bold text-gray-800">üí∞ Separar Dinheiro no Cofre</h2>
                        <div class="text-right">
                            <p class="text-sm text-gray-600">Saldo Dispon√≠vel</p>
                            <p class="text-lg font-bold text-green-600" id="availableBalance">R$ 0,00</p>
                        </div>
                    </div>
                    <form id="savingsForm" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Valor (R$)</label>
                                <input type="number" id="savingAmount" step="0.01" min="0" 
                                       class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Finalidade do Cofre</label>
                                <select id="savingPurpose" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option value="Emerg√™ncia">üö® Emerg√™ncia</option>
                                    <option value="Manuten√ß√£o">üîß Manuten√ß√£o Futura</option>
                                    <option value="Investimento">üìà Investimento</option>
                                    <option value="IPVA">üöó IPVA</option>
                                    <option value="Seguro">üõ°Ô∏è Seguro</option>
                                    <option value="F√©rias">üèñÔ∏è F√©rias</option>
                                    <option value="Outros">üíº Outros</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Meta (R$) - Opcional</label>
                                <input type="number" id="savingGoal" step="0.01" min="0" placeholder="Ex: 5000.00"
                                       class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Observa√ß√µes</label>
                            <input type="text" id="savingNotes" placeholder="Ex: Para troca de pneus em dezembro"
                                   class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 font-semibold">
                            üí∞ Guardar no Cofre
                        </button>
                    </form>
                </div>

                <!-- Resumo de Cofres -->
                <div class="bg-white rounded-lg shadow p-6 mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold">üí∞ Meus Cofres</h3>
                        <div class="text-right">
                            <p class="text-sm text-gray-600">Total Guardado</p>
                            <p class="text-2xl font-bold text-blue-600" id="totalSavingsAmount">R$ 0,00</p>
                        </div>
                    </div>
                    <div id="savingsSummary" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <!-- Resumo dos cofres -->
                    </div>
                </div>

                <!-- Hist√≥rico de Movimenta√ß√µes -->
                <div class="bg-white rounded-lg shadow p-6">
                    <h3 class="text-lg font-semibold mb-4">üìã Hist√≥rico de Movimenta√ß√µes</h3>
                    <div id="savingsHistory" class="space-y-3">
                        <!-- Hist√≥rico ser√° listado aqui -->
                    </div>
                </div>
            </div>

            <!-- Aba Metas -->
            <div id="goalsTab" class="tab-content hidden">
                <div class="bg-white rounded-lg shadow p-6 mb-6">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">üéØ Definir Nova Meta</h2>
                    <form id="goalsForm" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Nome da Meta</label>
                                <input type="text" id="goalName" placeholder="Ex: Comprar carro novo" required
                                       class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Valor da Meta (R$)</label>
                                <input type="number" id="goalAmount" step="0.01" min="0" required
                                       class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Data Limite</label>
                                <input type="date" id="goalDate" required
                                       class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Categoria</label>
                                <select id="goalCategory" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500">
                                    <option value="Ve√≠culo">üöó Ve√≠culo</option>
                                    <option value="Casa">üè† Casa</option>
                                    <option value="Viagem">‚úàÔ∏è Viagem</option>
                                    <option value="Educa√ß√£o">üìö Educa√ß√£o</option>
                                    <option value="Sa√∫de">üè• Sa√∫de</option>
                                    <option value="Neg√≥cio">üíº Neg√≥cio</option>
                                    <option value="Outros">üéØ Outros</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Descri√ß√£o</label>
                            <textarea id="goalDescription" rows="2" placeholder="Descreva sua meta..."
                                      class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"></textarea>
                        </div>
                        <button type="submit" class="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 font-semibold">
                            üéØ Criar Meta
                        </button>
                    </form>
                </div>

                <!-- Lista de Metas -->
                <div class="bg-white rounded-lg shadow p-6">
                    <h3 class="text-lg font-semibold mb-4">üìä Minhas Metas</h3>
                    <div id="goalsList" class="space-y-4">
                        <!-- Metas ser√£o listadas aqui -->
                    </div>
                </div>
            </div>

            <!-- Aba Apoiadores -->
            <div id="supportersTab" class="tab-content hidden">
                <div class="bg-white rounded-lg shadow p-6 mb-6">
                    <div class="text-center mb-8">
                        <h2 class="text-2xl font-bold text-green-800 mb-4">Nossos Apoiadores</h2>
                        <p class="text-gray-600">Empresas e organiza√ß√µes que apoiam o desenvolvimento do Volante Financeiro</p>
                    </div>

                    <div id="supportersList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Apoiadores ser√£o carregados aqui -->
                    </div>

                    <div class="text-center mt-8 p-6 bg-green-50 rounded-lg">
                        <h3 class="text-lg font-semibold text-green-800 mb-2">Quer apoiar nosso projeto?</h3>
                        <p class="text-gray-600 mb-4">Entre em contato conosco para saber como sua empresa pode apoiar o Volante Financeiro</p>
                        <div class="flex flex-wrap justify-center gap-3">
                            <button onclick="contactSupportWhatsApp()" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 font-semibold flex items-center space-x-2">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"/>
                                </svg>
                                <span>WhatsApp</span>
                            </button>
                            <button onclick="contactSupportEmail()" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 font-semibold flex items-center space-x-2">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M24 5.457v13.909c0 .904-.732 1.636-1.636 1.636h-3.819V11.73L12 16.64l-6.545-4.91v9.273H1.636A1.636 1.636 0 0 1 0 19.366V5.457c0-.904.732-1.636 1.636-1.636h3.819v.273L12 10.186l6.545-6.092v-.273h3.819c.904 0 1.636.732 1.636 1.636z"/>
                                </svg>
                                <span>Email</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Aba An√°lises -->
            <div id="analyticsTab" class="tab-content hidden">
                <!-- Seletor de Per√≠odo -->
                <div class="bg-white rounded-lg shadow p-4 mb-6">
                    <div class="flex flex-wrap items-center justify-between gap-4">
                        <h2 class="text-xl font-bold text-gray-800">üìä An√°lises Financeiras</h2>
                        <div class="flex items-center space-x-4">
                            <label class="text-sm font-medium text-gray-700">Per√≠odo:</label>
                            <select id="analyticsPeriod" onchange="updateAnalyticsPeriod()" class="px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500">
                                <option value="daily">üìÖ Di√°rio</option>
                                <option value="weekly">üìä Semanal</option>
                                <option value="monthly" selected>üìà Mensal</option>
                                <option value="yearly">üóìÔ∏è Anual</option>
                            </select>
                            <input type="month" id="analyticsMonth" onchange="updateAnalyticsPeriod()" 
                                   class="px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500">
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-4" id="summaryTitle">Resumo Mensal</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-gray-600">Total Ganhos:</span>
                                <span class="font-semibold text-green-600" id="totalEarnings">R$ 0,00</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Total Despesas:</span>
                                <span class="font-semibold text-red-600" id="totalExpenses">R$ 0,00</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Total Reservas:</span>
                                <span class="font-semibold text-blue-600" id="totalSavings">R$ 0,00</span>
                            </div>
                            <hr>
                            <div class="flex justify-between text-lg">
                                <span class="font-semibold">Lucro L√≠quido:</span>
                                <span class="font-bold" id="netProfit">R$ 0,00</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-4">Gr√°fico Mensal</h3>
                        <div class="relative h-64">
                            <canvas id="monthlyChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Aba Exportar -->
            <div id="exportTab" class="tab-content hidden">
                <div class="bg-white rounded-lg shadow p-6 mb-6">
                    <h2 class="text-xl font-bold text-gray-800 mb-6">üìä Exportar Dados</h2>
                    
                    <!-- Seletor de Per√≠odo para Exporta√ß√£o -->
                    <div class="bg-gray-50 p-4 rounded-lg mb-6">
                        <h3 class="text-lg font-semibold mb-4">Per√≠odo dos Dados</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Data Inicial</label>
                                <input type="date" id="exportStartDate" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Data Final</label>
                                <input type="date" id="exportEndDate" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500">
                            </div>
                            <div class="flex items-end">
                                <button onclick="setQuickPeriod('month')" class="w-full bg-blue-100 text-blue-700 px-3 py-2 rounded-lg text-sm hover:bg-blue-200 mr-2">
                                    Este M√™s
                                </button>
                                <button onclick="setQuickPeriod('all')" class="w-full bg-gray-100 text-gray-700 px-3 py-2 rounded-lg text-sm hover:bg-gray-200">
                                    Todos
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Op√ß√µes de Exporta√ß√£o -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Exportar Ganhos -->
                        <div class="bg-green-50 border border-green-200 rounded-lg p-6">
                            <div class="flex items-center mb-4">
                                <div class="w-12 h-12 bg-green-600 rounded-lg flex items-center justify-center mr-4">
                                    <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M4 4a2 2 0 00-2 2v4a2 2 0 002 2V6h10a2 2 0 00-2-2H4zm2 6a2 2 0 012-2h8a2 2 0 012 2v4a2 2 0 01-2 2H8a2 2 0 01-2-2v-4zm6 4a2 2 0 100-4 2 2 0 000 4z"/>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-green-800">Ganhos</h3>
                                    <p class="text-sm text-green-600" id="earningsCount">0 registros</p>
                                </div>
                            </div>
                            <button onclick="exportData('earnings')" class="w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700 font-semibold">
                                üì• Exportar Ganhos
                            </button>
                        </div>

                        <!-- Exportar Despesas -->
                        <div class="bg-red-50 border border-red-200 rounded-lg p-6">
                            <div class="flex items-center mb-4">
                                <div class="w-12 h-12 bg-red-600 rounded-lg flex items-center justify-center mr-4">
                                    <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z"/>
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z" clip-rule="evenodd"/>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-red-800">Despesas</h3>
                                    <p class="text-sm text-red-600" id="expensesCount">0 registros</p>
                                </div>
                            </div>
                            <button onclick="exportData('expenses')" class="w-full bg-red-600 text-white py-2 rounded-lg hover:bg-red-700 font-semibold">
                                üì• Exportar Despesas
                            </button>
                        </div>

                        <!-- Exportar Cofres -->
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
                            <div class="flex items-center mb-4">
                                <div class="w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center mr-4">
                                    <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4z"/>
                                        <path fill-rule="evenodd" d="M18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z" clip-rule="evenodd"/>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-blue-800">Cofres</h3>
                                    <p class="text-sm text-blue-600" id="savingsCount">0 registros</p>
                                </div>
                            </div>
                            <button onclick="exportData('savings')" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 font-semibold">
                                üì• Exportar Cofres
                            </button>
                        </div>

                        <!-- Exportar Metas -->
                        <div class="bg-purple-50 border border-purple-200 rounded-lg p-6">
                            <div class="flex items-center mb-4">
                                <div class="w-12 h-12 bg-purple-600 rounded-lg flex items-center justify-center mr-4">
                                    <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.293l-3-3a1 1 0 00-1.414 0l-3 3a1 1 0 001.414 1.414L9 9.414V13a1 1 0 102 0V9.414l1.293 1.293a1 1 0 001.414-1.414z" clip-rule="evenodd"/>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-purple-800">Metas</h3>
                                    <p class="text-sm text-purple-600" id="goalsCount">0 registros</p>
                                </div>
                            </div>
                            <button onclick="exportData('goals')" class="w-full bg-purple-600 text-white py-2 rounded-lg hover:bg-purple-700 font-semibold">
                                üì• Exportar Metas
                            </button>
                        </div>

                        <!-- Relat√≥rio Completo -->
                        <div class="bg-gray-50 border border-gray-200 rounded-lg p-6">
                            <div class="flex items-center mb-4">
                                <div class="w-12 h-12 bg-gray-600 rounded-lg flex items-center justify-center mr-4">
                                    <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd"/>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-gray-800">Relat√≥rio Completo</h3>
                                    <p class="text-sm text-gray-600">Todos os dados</p>
                                </div>
                            </div>
                            <button onclick="exportData('complete')" class="w-full bg-gray-600 text-white py-2 rounded-lg hover:bg-gray-700 font-semibold">
                                üìã Gerar Relat√≥rio
                            </button>
                        </div>

                        <!-- Backup Completo -->
                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-6">
                            <div class="flex items-center mb-4">
                                <div class="w-12 h-12 bg-yellow-600 rounded-lg flex items-center justify-center mr-4">
                                    <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-yellow-800">Backup</h3>
                                    <p class="text-sm text-yellow-600">Dados + configura√ß√µes</p>
                                </div>
                            </div>
                            <button onclick="exportData('backup')" class="w-full bg-yellow-600 text-white py-2 rounded-lg hover:bg-yellow-700 font-semibold">
                                üíæ Fazer Backup
                            </button>
                        </div>
                    </div>

                    <!-- Importar Backup -->
                    <div class="mt-8 bg-blue-50 border border-blue-200 rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-blue-800 mb-4">üì§ Importar Backup</h3>
                        <div class="flex items-center space-x-4">
                            <input type="file" id="importBackup" accept=".json" class="flex-1 px-3 py-2 border rounded-lg">
                            <button onclick="importBackup()" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 font-semibold">
                                Importar
                            </button>
                        </div>
                        <p class="text-sm text-blue-600 mt-2">‚ö†Ô∏è Aten√ß√£o: Importar um backup substituir√° todos os dados atuais!</p>
                    </div>
                </div>
            </div>

            <!-- Aba Sobre -->
            <div id="aboutTab" class="tab-content hidden">
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="text-center mb-8">
                        <div class="w-20 h-20 mx-auto mb-4 bg-green-600 rounded-full flex items-center justify-center" id="aboutPageLogo">
                            <span class="text-white font-bold text-2xl">$</span>
                        </div>
                        <h2 class="text-2xl font-bold text-green-800 mb-2">Volante Financeiro</h2>
                        <p class="text-gray-600">Sistema de Gest√£o Financeira para Motoristas</p>
                    </div>

                    <div class="space-y-6">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-800 mb-3">Sobre o Projeto</h3>
                            <p class="text-gray-600 leading-relaxed">
                                O Volante Financeiro √© um aplicativo desenvolvido especialmente para motoristas de aplicativo 
                                e profissionais do transporte em Corumb√°-MS e Lad√°rio-MS. O sistema permite organizar despesas 
                                pessoais e operacionais, planejar ganhos, monitorar custos e otimizar a rentabilidade, 
                                adaptando-se √† realidade local da regi√£o.
                            </p>
                        </div>

                        <div>
                            <h3 class="text-lg font-semibold text-gray-800 mb-3">Desenvolvedores</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="bg-gray-50 p-4 rounded-lg">
                                    <h4 class="font-semibold text-green-700 mb-2">Equipe de Desenvolvimento</h4>
                                    <ul class="text-sm text-gray-600 space-y-1">
                                        <li>‚Ä¢ Jo√£o Victor Ribeiro de Souza</li>
                                        <li>‚Ä¢ Odilon Chalis</li>
                                        <li>‚Ä¢ Thaviny Maria Moraes de Toledo Soares</li>
                                        <li>‚Ä¢ Wallace Kau√£ Samosa Coronel</li>
                                    </ul>
                                </div>
                                <div class="bg-gray-50 p-4 rounded-lg">
                                    <h4 class="font-semibold text-green-700 mb-2">Professores Respons√°veis</h4>
                                    <ul class="text-sm text-gray-600 space-y-1">
                                        <li>‚Ä¢ Gabriela Luiza da Costa Neves</li>
                                        <li>‚Ä¢ Wellington Cesar de Oliveira</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div>
                            <h3 class="text-lg font-semibold text-gray-800 mb-3">Funcionalidades</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <ul class="text-sm text-gray-600 space-y-2">
                                    <li class="flex items-center">
                                        <span class="w-2 h-2 bg-green-500 rounded-full mr-3"></span>
                                        Controle de ganhos por corrida/entrega
                                    </li>
                                    <li class="flex items-center">
                                        <span class="w-2 h-2 bg-green-500 rounded-full mr-3"></span>
                                        Gest√£o de despesas operacionais
                                    </li>
                                    <li class="flex items-center">
                                        <span class="w-2 h-2 bg-green-500 rounded-full mr-3"></span>
                                        Sistema de reservas financeiras
                                    </li>
                                    <li class="flex items-center">
                                        <span class="w-2 h-2 bg-green-500 rounded-full mr-3"></span>
                                        An√°lises e relat√≥rios detalhados
                                    </li>
                                </ul>
                                <ul class="text-sm text-gray-600 space-y-2">
                                    <li class="flex items-center">
                                        <span class="w-2 h-2 bg-green-500 rounded-full mr-3"></span>
                                        Suporte a m√∫ltiplas plataformas
                                    </li>
                                    <li class="flex items-center">
                                        <span class="w-2 h-2 bg-green-500 rounded-full mr-3"></span>
                                        Interface responsiva e intuitiva
                                    </li>
                                    <li class="flex items-center">
                                        <span class="w-2 h-2 bg-green-500 rounded-full mr-3"></span>
                                        Painel administrativo completo
                                    </li>
                                    <li class="flex items-center">
                                        <span class="w-2 h-2 bg-green-500 rounded-full mr-3"></span>
                                        Notifica√ß√µes via WhatsApp
                                    </li>
                                </ul>
                            </div>
                        </div>

                        <div class="text-center pt-6 border-t">
                            <p class="text-sm text-gray-500">
                                Vers√£o 1.0 - 2024 | Desenvolvido com ‚ù§Ô∏è para a comunidade de motoristas
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Rodap√© -->
        <footer class="mt-auto bg-green-800 text-white py-3">
            <div class="text-center">
                <p class="text-sm">Desenvolvido por <strong>Escola Estadual Dr. Jo√£o Leite de Barros</strong></p>
            </div>
        </footer>
    </div>

    <!-- Painel Administrador -->
    <div id="adminDashboard" class="hidden min-h-screen bg-gray-50">
        <!-- Header Admin -->
        <header class="bg-red-600 text-white shadow-sm">
            <div class="px-4 py-4 flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-white rounded-full flex items-center justify-center">
                        <span class="text-red-600 font-bold">A</span>
                    </div>
                    <div>
                        <h1 class="font-bold">Painel Administrador</h1>
                        <p class="text-xs opacity-75">Volante Financeiro</p>
                    </div>
                </div>
                <button onclick="logout()" class="bg-red-700 px-4 py-2 rounded hover:bg-red-800">
                    Sair
                </button>
            </div>
        </header>

        <!-- Navega√ß√£o Admin -->
        <nav class="bg-white border-b">
            <div class="flex overflow-x-auto">
                <button onclick="showAdminTab('users')" class="admin-tab-btn px-6 py-3 text-sm font-medium border-b-2 border-red-600 text-red-600">
                    Usu√°rios
                </button>
                <button onclick="showAdminTab('settings')" class="admin-tab-btn px-6 py-3 text-sm font-medium text-gray-500 hover:text-red-600">
                    Configura√ß√µes
                </button>
                <button onclick="showAdminTab('supporters')" class="admin-tab-btn px-6 py-3 text-sm font-medium text-gray-500 hover:text-red-600">
                    Apoiadores
                </button>
                <button onclick="showAdminTab('about')" class="admin-tab-btn px-6 py-3 text-sm font-medium text-gray-500 hover:text-red-600">
                    Editar Sobre
                </button>
            </div>
        </nav>

        <div class="p-4">
            <!-- Aba Usu√°rios -->
            <div id="adminUsersTab" class="admin-tab-content">
                <div class="bg-white rounded-lg shadow p-6 mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-bold text-gray-800">Gerenciar Usu√°rios</h2>
                        <button onclick="showAddUserForm()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
                            Adicionar Usu√°rio
                        </button>
                    </div>
                    
                    <!-- Lista de Usu√°rios -->
                    <div id="usersList" class="space-y-3">
                        <!-- Usu√°rios ser√£o listados aqui -->
                    </div>
                </div>

                <!-- Se√ß√£o Gerar Nova Senha -->
                <div class="bg-white rounded-lg shadow p-6">
                    <h3 class="text-lg font-semibold mb-4">Gerar Nova Senha para Usu√°rio</h3>
                    <form id="generatePasswordForm" class="flex gap-4">
                        <div class="flex-1">
                            <select id="userSelectPassword" class="w-full px-3 py-2 border rounded-lg">
                                <option value="">Selecione um usu√°rio...</option>
                            </select>
                        </div>
                        <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">
                            Gerar Nova Senha
                        </button>
                    </form>
                </div>
            </div>

            <!-- Aba Configura√ß√µes -->
            <div id="adminSettingsTab" class="admin-tab-content hidden">
                <div class="bg-white rounded-lg shadow p-6 mb-6">
                    <h2 class="text-xl font-bold text-gray-800 mb-6">Configura√ß√µes do Sistema</h2>
                    
                    <div class="space-y-6">
                        <!-- Configura√ß√µes de Contato -->
                        <div class="border-b pb-6">
                            <h3 class="text-lg font-semibold mb-4">üìû Informa√ß√µes de Contato</h3>
                            <form id="contactSettingsForm" class="space-y-4">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Email de Contato</label>
                                        <input type="email" id="contactEmail" placeholder="contato@exemplo.com"
                                               class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-red-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">WhatsApp de Contato</label>
                                        <input type="tel" id="contactWhatsapp" placeholder="(67) 99999-9999"
                                               class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-red-500">
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Mensagem Padr√£o para Apoiadores</label>
                                    <textarea id="supporterMessage" rows="3" placeholder="Mensagem que ser√° enviada quando apoiadores entrarem em contato..."
                                              class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-red-500"></textarea>
                                </div>
                                <button type="submit" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700">
                                    Salvar Configura√ß√µes de Contato
                                </button>
                            </form>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold mb-3">Logo do Aplicativo</h3>
                            <div class="flex items-center space-x-4">
                                <div class="w-16 h-16 bg-green-600 rounded-full flex items-center justify-center" id="adminAppLogoPreview">
                                    <span class="text-white font-bold text-xl">$</span>
                                </div>
                                <div>
                                    <input type="file" id="appLogoInput" accept="image/*" class="hidden">
                                    <button onclick="document.getElementById('appLogoInput').click()" 
                                            class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 mb-2 block">
                                        Escolher Imagem
                                    </button>
                                    <p class="text-xs text-gray-500">Formatos: JPG, PNG, GIF (m√°x. 2MB)</p>
                                </div>
                            </div>
                        </div>

                        <div>
                            <h3 class="text-lg font-semibold mb-3">Logo Volante Financeiro (Aba Sobre)</h3>
                            <div class="flex items-center space-x-4">
                                <div class="w-20 h-20 bg-green-600 rounded-full flex items-center justify-center" id="aboutLogoPreview">
                                    <span class="text-white font-bold text-2xl">$</span>
                                </div>
                                <div>
                                    <input type="file" id="aboutLogoInput" accept="image/png,image/jpeg" class="hidden">
                                    <button onclick="document.getElementById('aboutLogoInput').click()" 
                                            class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 mb-2 block">
                                        Escolher Logo PNG/JPEG
                                    </button>
                                    <button onclick="saveAboutLogo()" id="saveAboutLogoBtn" 
                                            class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 mb-2 block disabled:bg-gray-400" disabled>
                                        Salvar Logo da Aba Sobre
                                    </button>
                                    <p class="text-xs text-gray-500">Formatos: PNG, JPEG (m√°x. 2MB) - Aparecer√° na aba Sobre</p>
                                </div>
                            </div>
                        </div>

                        <div>
                            <h3 class="text-lg font-semibold mb-3">Logo do Desenvolvedor</h3>
                            <div class="flex items-center space-x-4">
                                <div class="w-16 h-16 bg-gray-600 rounded-lg flex items-center justify-center" id="devLogoPreview">
                                    <span class="text-white font-bold text-xs">EEJLB</span>
                                </div>
                                <div>
                                    <input type="file" id="devLogoInput" accept="image/png,image/jpeg" class="hidden">
                                    <button onclick="document.getElementById('devLogoInput').click()" 
                                            class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 mb-2 block">
                                        Escolher Imagem
                                    </button>
                                    <button onclick="saveDevLogo()" id="saveDevLogoBtn" 
                                            class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 mb-2 block disabled:bg-gray-400" disabled>
                                        Salvar Altera√ß√£o
                                    </button>
                                    <p class="text-xs text-gray-500">Formatos: PNG, JPEG (m√°x. 2MB)</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Aba Apoiadores Admin -->
            <div id="adminSupportersTab" class="admin-tab-content hidden">
                <div class="bg-white rounded-lg shadow p-6 mb-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-gray-800">Gerenciar Apoiadores</h2>
                        <button onclick="showAddSupporterForm()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
                            Adicionar Apoiador
                        </button>
                    </div>
                    
                    <!-- Lista de Apoiadores -->
                    <div id="adminSupportersList" class="space-y-4">
                        <!-- Apoiadores ser√£o listados aqui -->
                    </div>
                </div>
            </div>

            <!-- Aba Editar Sobre -->
            <div id="adminAboutTab" class="admin-tab-content hidden">
                <div class="bg-white rounded-lg shadow p-6">
                    <h2 class="text-xl font-bold text-gray-800 mb-6">Editar Informa√ß√µes da Aba Sobre</h2>
                    
                    <form id="editAboutForm" class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Descri√ß√£o do Projeto</label>
                            <textarea id="projectDescription" rows="4" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-red-500">O Volante Financeiro √© um aplicativo desenvolvido especialmente para motoristas de aplicativo e profissionais do transporte em Corumb√°-MS e Lad√°rio-MS. O sistema permite organizar despesas pessoais e operacionais, planejar ganhos, monitorar custos e otimizar a rentabilidade, adaptando-se √† realidade local da regi√£o.</textarea>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Equipe de Desenvolvimento</label>
                                <textarea id="devTeam" rows="4" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-red-500">‚Ä¢ Jo√£o Victor Ribeiro de Souza
‚Ä¢ Odilon Chalis
‚Ä¢ Thaviny Maria Moraes de Toledo Soares
‚Ä¢ Wallace Kau√£ Samosa Coronel</textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Professores Respons√°veis</label>
                                <textarea id="teachers" rows="4" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-red-500">‚Ä¢ Gabriela Luiza da Costa Neves
‚Ä¢ Wellington Cesar de Oliveira</textarea>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nome da Escola</label>
                            <input type="text" id="schoolName" value="Escola Estadual Dr. Jo√£o Leite de Barros" 
                                   class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-red-500">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Vers√£o do Sistema</label>
                            <input type="text" id="systemVersion" value="1.0 - 2024" 
                                   class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-red-500">
                        </div>

                        <button type="submit" class="bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 font-semibold">
                            Salvar Altera√ß√µes
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Adicionar Apoiador -->
    <div id="addSupporterModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-lg p-6 w-full max-w-md max-h-[90vh] overflow-y-auto">
            <h3 class="text-lg font-bold mb-4">Adicionar Apoiador</h3>
            <form id="addSupporterForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Nome da Empresa</label>
                    <input type="text" id="supporterName" required
                           class="w-full px-3 py-2 border rounded-lg">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Descri√ß√£o</label>
                    <textarea id="supporterDescription" rows="3" 
                              class="w-full px-3 py-2 border rounded-lg"></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Website (opcional)</label>
                    <input type="url" id="supporterWebsite" placeholder="https://exemplo.com"
                           class="w-full px-3 py-2 border rounded-lg">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Telefone (opcional)</label>
                    <input type="tel" id="supporterPhone" placeholder="(67) 99999-9999"
                           class="w-full px-3 py-2 border rounded-lg">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Logo da Empresa</label>
                    <input type="file" id="supporterLogo" accept="image/*"
                           class="w-full px-3 py-2 border rounded-lg">
                    <p class="text-xs text-gray-500 mt-1">Formatos: JPG, PNG, GIF (m√°x. 2MB)</p>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Tipo de Apoio</label>
                    <select id="supporterType" required class="w-full px-3 py-2 border rounded-lg">
                        <option value="">Selecione...</option>
                        <option value="Patrocinador Principal">Patrocinador Principal</option>
                        <option value="Patrocinador">Patrocinador</option>
                        <option value="Apoiador">Apoiador</option>
                        <option value="Parceiro">Parceiro</option>
                    </select>
                </div>
                <div class="flex space-x-3">
                    <button type="submit" class="flex-1 bg-green-600 text-white py-2 rounded hover:bg-green-700">
                        Adicionar
                    </button>
                    <button type="button" onclick="hideAddSupporterForm()" class="flex-1 bg-gray-500 text-white py-2 rounded hover:bg-gray-600">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Adicionar Usu√°rio -->
    <div id="addUserModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-lg p-6 w-full max-w-md">
            <h3 class="text-lg font-bold mb-4">Adicionar Novo Usu√°rio</h3>
            <form id="adminAddUserForm" class="space-y-4">
                <input type="text" id="adminUserName" placeholder="Nome Completo" required
                       class="w-full px-3 py-2 border rounded-lg">
                <input type="text" id="adminUserCpf" placeholder="CPF" required
                       class="w-full px-3 py-2 border rounded-lg">
                <input type="number" id="adminUserAge" placeholder="Idade" min="18" required
                       class="w-full px-3 py-2 border rounded-lg">
                <input type="email" id="adminUserEmail" placeholder="Email" required
                       class="w-full px-3 py-2 border rounded-lg">
                <input type="tel" id="adminUserWhatsapp" placeholder="WhatsApp: (67) 99999-9999" required
                       class="w-full px-3 py-2 border rounded-lg">
                <input type="password" id="adminUserPassword" placeholder="Senha" required
                       class="w-full px-3 py-2 border rounded-lg">
                <select id="adminUserPlatform" required class="w-full px-3 py-2 border rounded-lg">
                    <option value="">Selecione a plataforma...</option>
                    <option value="BR Car">BR Car</option>
                    <option value="IBolt">IBolt</option>
                    <option value="Ifood">Ifood</option>
                    <option value="InDriver">InDriver</option>
                    <option value="Uber">Uber</option>
                    <option value="T√¥ Aqui">T√¥ Aqui</option>
                    <option value="Taxi-Connect">Taxi-Connect</option>
                    <option value="Urban">Urban</option>
                    <option value="Outros">Outros</option>
                </select>
                <div class="flex space-x-3">
                    <button type="submit" class="flex-1 bg-green-600 text-white py-2 rounded hover:bg-green-700">
                        Adicionar
                    </button>
                    <button type="button" onclick="hideAddUserForm()" class="flex-1 bg-gray-500 text-white py-2 rounded hover:bg-gray-600">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Sistema de Banco de Dados Local
        class VolanteDB {
            constructor() {
                this.dbName = 'volante_financeiro_db';
                this.version = 1;
                this.db = null;
                this.init();
            }

            async init() {
                // Migrar dados do localStorage se existirem
                this.migrateFromLocalStorage();
            }

            migrateFromLocalStorage() {
                const tables = ['users', 'earnings', 'expenses', 'savings', 'supporters', 'goals'];
                tables.forEach(table => {
                    const data = JSON.parse(localStorage.getItem(`volante_${table}`) || '[]');
                    if (data.length > 0) {
                        this.setTable(table, data);
                        localStorage.removeItem(`volante_${table}`);
                    }
                });
            }

            setTable(tableName, data) {
                localStorage.setItem(`db_${this.dbName}_${tableName}`, JSON.stringify(data));
            }

            getTable(tableName) {
                return JSON.parse(localStorage.getItem(`db_${this.dbName}_${tableName}`) || '[]');
            }

            insert(tableName, record) {
                const table = this.getTable(tableName);
                record.id = record.id || Date.now() + Math.random();
                record.createdAt = record.createdAt || new Date().toISOString();
                record.updatedAt = new Date().toISOString();
                table.push(record);
                this.setTable(tableName, table);
                return record;
            }

            update(tableName, id, updates) {
                const table = this.getTable(tableName);
                const index = table.findIndex(record => record.id === id);
                if (index !== -1) {
                    table[index] = { ...table[index], ...updates, updatedAt: new Date().toISOString() };
                    this.setTable(tableName, table);
                    return table[index];
                }
                return null;
            }

            delete(tableName, id) {
                const table = this.getTable(tableName);
                const filtered = table.filter(record => record.id !== id);
                this.setTable(tableName, filtered);
                return filtered.length < table.length;
            }

            find(tableName, query = {}) {
                const table = this.getTable(tableName);
                if (Object.keys(query).length === 0) return table;
                
                return table.filter(record => {
                    return Object.entries(query).every(([key, value]) => {
                        if (typeof value === 'function') return value(record[key]);
                        return record[key] === value;
                    });
                });
            }

            findOne(tableName, query) {
                return this.find(tableName, query)[0] || null;
            }

            // M√©todos espec√≠ficos para c√°lculos financeiros
            getAvailableBalance(userId) {
                const userEarnings = this.find('earnings', { userId });
                const userExpenses = this.find('expenses', { userId });
                const userSavings = this.find('savings', { userId });

                const totalEarnings = userEarnings.reduce((sum, e) => sum + e.amount, 0);
                const totalExpenses = userExpenses.reduce((sum, e) => sum + e.amount, 0);
                const totalSaved = userSavings.reduce((sum, s) => sum + s.amount, 0);

                return totalEarnings - totalExpenses - totalSaved;
            }

            getTotalSavings(userId) {
                const userSavings = this.find('savings', { userId });
                return userSavings.reduce((sum, s) => sum + s.amount, 0);
            }

            getSavingsByPurpose(userId) {
                const userSavings = this.find('savings', { userId });
                return userSavings.reduce((groups, saving) => {
                    const purpose = saving.purpose;
                    if (!groups[purpose]) {
                        groups[purpose] = { total: 0, goal: null, items: [] };
                    }
                    groups[purpose].total += saving.amount;
                    groups[purpose].items.push(saving);
                    if (saving.goal && saving.goal > (groups[purpose].goal || 0)) {
                        groups[purpose].goal = saving.goal;
                    }
                    return groups;
                }, {});
            }

            // Backup e restore
            exportData(userId = null) {
                const tables = ['users', 'earnings', 'expenses', 'savings', 'supporters', 'goals'];
                const data = {};
                
                tables.forEach(table => {
                    if (userId && ['earnings', 'expenses', 'savings', 'goals'].includes(table)) {
                        data[table] = this.find(table, { userId });
                    } else {
                        data[table] = this.getTable(table);
                    }
                });

                return {
                    version: this.version,
                    timestamp: new Date().toISOString(),
                    data
                };
            }

            importData(backupData, userId = null) {
                if (userId) {
                    // Importar apenas dados do usu√°rio espec√≠fico
                    ['earnings', 'expenses', 'savings', 'goals'].forEach(table => {
                        if (backupData.data[table]) {
                            // Remover dados existentes do usu√°rio
                            const existingData = this.find(table, { userId: (id) => id !== userId });
                            // Adicionar dados do backup
                            const newData = backupData.data[table].map(item => ({
                                ...item,
                                userId,
                                id: Date.now() + Math.random(),
                                createdAt: item.createdAt || new Date().toISOString(),
                                updatedAt: new Date().toISOString()
                            }));
                            this.setTable(table, [...existingData, ...newData]);
                        }
                    });
                } else {
                    // Importar todos os dados
                    Object.entries(backupData.data).forEach(([table, records]) => {
                        this.setTable(table, records);
                    });
                }
            }
        }

        // Inicializar banco de dados
        const db = new VolanteDB();
        let currentUser = null;

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            // Definir data atual nos campos de data
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('earningDate').value = today;
            document.getElementById('expenseDate').value = today;
            document.getElementById('goalDate').value = new Date(Date.now() + 30*24*60*60*1000).toISOString().split('T')[0]; // 30 dias no futuro



            // Carregar dados salvos do login
            loadRememberedLogin();
            
            // Definir m√™s atual no seletor de an√°lises
            document.getElementById('analyticsMonth').value = new Date().toISOString().slice(0, 7);

            // Event listeners
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('registerForm').addEventListener('submit', handleRegister);
            document.getElementById('resetForm').addEventListener('submit', handlePasswordReset);
            document.getElementById('adminLoginForm').addEventListener('submit', handleAdminLogin);
            document.getElementById('earningsForm').addEventListener('submit', handleAddEarning);
            document.getElementById('expensesForm').addEventListener('submit', handleAddExpense);
            document.getElementById('savingsForm').addEventListener('submit', handleAddSaving);
            document.getElementById('adminAddUserForm').addEventListener('submit', handleAdminAddUser);
            document.getElementById('generatePasswordForm').addEventListener('submit', handleGeneratePassword);
            document.getElementById('editAboutForm').addEventListener('submit', handleEditAbout);
            document.getElementById('addSupporterForm').addEventListener('submit', handleAddSupporter);
            document.getElementById('goalsForm').addEventListener('submit', handleAddGoal);
            document.getElementById('contactSettingsForm').addEventListener('submit', handleContactSettings);

            // Event listeners para busca e filtros
            document.getElementById('searchEarnings').addEventListener('input', filterEarnings);
            document.getElementById('filterEarningsPlatform').addEventListener('change', filterEarnings);
            document.getElementById('searchExpenses').addEventListener('input', filterExpenses);
            document.getElementById('filterExpensesCategory').addEventListener('change', filterExpenses);

            // Carregar configura√ß√µes de contato salvas
            loadContactSettings();

            // Formata√ß√£o de CPF e WhatsApp
            document.getElementById('loginCpf').addEventListener('input', function(e) {
                formatCPF(e);
                validateCPFRealTime(e);
            });
            document.getElementById('regCpf').addEventListener('input', formatCPF);
            document.getElementById('adminUserCpf').addEventListener('input', formatCPF);
            document.getElementById('regWhatsapp').addEventListener('input', formatWhatsApp);
            document.getElementById('adminUserWhatsapp').addEventListener('input', formatWhatsApp);
            document.getElementById('contactWhatsapp').addEventListener('input', formatWhatsApp);

            // Upload de imagens
            document.getElementById('appLogoInput').addEventListener('change', handleAppLogoUpload);
            document.getElementById('devLogoInput').addEventListener('change', handleDevLogoUpload);
            document.getElementById('aboutLogoInput').addEventListener('change', handleAboutLogoUpload);
        });



        // Fun√ß√£o para lidar com login de teste
        function handleTestLogin() {
            try {
                // Verificar se j√° existe um usu√°rio de teste ativo
                let testUser = db.findOne('users', { isTestUser: true, active: true });
                
                if (!testUser) {
                    // Criar novo usu√°rio de teste
                    const testStartDate = new Date();
                    const testEndDate = new Date(testStartDate.getTime() + 7 * 24 * 60 * 60 * 1000); // 7 dias
                    
                    testUser = db.insert('users', {
                        name: "Usu√°rio Teste",
                        email: "teste@volantefinanceiro.com",
                        cpf: "000.000.000-00",
                        age: "25",
                        whatsapp: "",
                        password: "teste123",
                        platform: "Teste",
                        active: true,
                        isTestUser: true,
                        testStartDate: testStartDate.toISOString(),
                        testEndDate: testEndDate.toISOString(),
                        picture: null
                    });
                    
                    showNotification(
                        `üéâ Bem-vindo ao Teste Gr√°tis! Voc√™ pode usar por 7 dias at√© ${testEndDate.toLocaleDateString('pt-BR')}`,
                        'success',
                        5000
                    );
                } else {
                    // Verificar se o per√≠odo de teste ainda √© v√°lido
                    const now = new Date();
                    const testEnd = new Date(testUser.testEndDate);
                    
                    if (now > testEnd) {
                        // Per√≠odo de teste expirado
                        db.update('users', testUser.id, { active: false });
                        
                        const shouldRegister = confirm(
                            `‚è∞ Per√≠odo de teste expirado!\n\n` +
                            `Seu teste de 7 dias terminou em ${testEnd.toLocaleDateString('pt-BR')}.\n` +
                            `Para continuar usando o Volante Financeiro, voc√™ precisa fazer seu cadastro.\n\n` +
                            `Deseja se cadastrar agora?`
                        );
                        
                        if (shouldRegister) {
                            showRegister();
                        }
                        return;
                    } else {
                        // Per√≠odo de teste ainda v√°lido
                        const daysLeft = Math.ceil((testEnd - now) / (1000 * 60 * 60 * 24));
                        showNotification(
                            `‚úÖ Bem-vindo de volta! Restam ${daysLeft} dia${daysLeft > 1 ? 's' : ''} de teste gratuito`,
                            'info',
                            4000
                        );
                    }
                }

                // Fazer login
                currentUser = testUser;
                document.getElementById('userWelcome').textContent = `Bem-vindo, ${testUser.name}! (Teste)`;
                showDashboard();
                
                // Mostrar aviso de teste no dashboard
                showTestUserWarning();
                
            } catch (error) {
                console.error('Erro no login de teste:', error);
                showNotification('Erro ao iniciar teste. Tente novamente.', 'error');
            }
        }



        // Fun√ß√µes de contato para apoiadores
        function contactSupportWhatsApp() {
            const contactSettings = JSON.parse(localStorage.getItem('volante_contact_settings') || '{}');
            const whatsapp = contactSettings.whatsapp || '67999999999';
            const message = contactSettings.supporterMessage || 'Ol√°! Gostaria de saber mais sobre como apoiar o projeto Volante Financeiro.';
            
            const whatsappUrl = `https://wa.me/55${whatsapp.replace(/\D/g, '')}?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        }

        function contactSupportEmail() {
            const contactSettings = JSON.parse(localStorage.getItem('volante_contact_settings') || '{}');
            const email = contactSettings.email || 'contato@volantefinanceiro.com';
            const subject = 'Interesse em apoiar o Volante Financeiro';
            const body = contactSettings.supporterMessage || 'Ol√°! Gostaria de saber mais sobre como apoiar o projeto Volante Financeiro.';
            
            const mailtoUrl = `mailto:${email}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            window.location.href = mailtoUrl;
        }

        // Fun√ß√£o para lidar com configura√ß√µes de contato
        function handleContactSettings(e) {
            e.preventDefault();
            
            const contactSettings = {
                email: document.getElementById('contactEmail').value,
                whatsapp: document.getElementById('contactWhatsapp').value,
                supporterMessage: document.getElementById('supporterMessage').value
            };
            
            localStorage.setItem('volante_contact_settings', JSON.stringify(contactSettings));
            alert('Configura√ß√µes de contato salvas com sucesso!');
        }

        // Fun√ß√µes de navega√ß√£o
        function showLogin() {
            hideAllScreens();
            document.getElementById('loginScreen').classList.remove('hidden');
        }

        function showRegister() {
            hideAllScreens();
            document.getElementById('registerScreen').classList.remove('hidden');
        }

        function showPasswordReset() {
            hideAllScreens();
            document.getElementById('passwordResetScreen').classList.remove('hidden');
        }

        function showAdminLogin() {
            hideAllScreens();
            document.getElementById('adminLoginScreen').classList.remove('hidden');
        }

        function showDashboard() {
            hideAllScreens();
            document.getElementById('dashboardScreen').classList.remove('hidden');
            updateDashboard();
            loadSavedLogos();
            updateAboutTab();
        }

        // Fun√ß√£o para mostrar aviso de usu√°rio teste
        function showTestUserWarning() {
            if (currentUser && currentUser.isTestUser) {
                const now = new Date();
                const testEnd = new Date(currentUser.testEndDate);
                const daysLeft = Math.ceil((testEnd - now) / (1000 * 60 * 60 * 24));
                
                // Criar elemento de aviso se n√£o existir
                let warningElement = document.getElementById('testUserWarning');
                if (!warningElement) {
                    warningElement = document.createElement('div');
                    warningElement.id = 'testUserWarning';
                    warningElement.className = 'bg-purple-100 border-l-4 border-purple-500 p-4 mb-4 mx-4';
                    
                    const dashboardContent = document.querySelector('#dashboardScreen .p-4');
                    dashboardContent.insertBefore(warningElement, dashboardContent.firstChild);
                }
                
                warningElement.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <svg class="w-5 h-5 text-purple-500 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                            </svg>
                            <div>
                                <p class="text-purple-800 font-semibold">
                                    üéØ Modo Teste Ativo - ${daysLeft} dia${daysLeft > 1 ? 's' : ''} restante${daysLeft > 1 ? 's' : ''}
                                </p>
                                <p class="text-purple-600 text-sm">
                                    Teste at√© ${testEnd.toLocaleDateString('pt-BR')}. Fa√ßa seu cadastro para continuar usando ap√≥s o per√≠odo de teste.
                                </p>
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="showRegister()" class="bg-purple-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-purple-700">
                                Cadastrar Agora
                            </button>
                            <button onclick="hideTestWarning()" class="text-purple-600 hover:text-purple-800 text-sm">
                                ‚úï
                            </button>
                        </div>
                    </div>
                `;
            }
        }

        // Fun√ß√£o para esconder aviso de teste
        function hideTestWarning() {
            const warningElement = document.getElementById('testUserWarning');
            if (warningElement) {
                warningElement.style.display = 'none';
            }
        }

        function showAdminDashboard() {
            hideAllScreens();
            document.getElementById('adminDashboard').classList.remove('hidden');
            loadUsersList();
            updateUserSelectOptions();
            loadSavedLogos();
            loadAboutInfo();
            loadAdminSupportersList();
        }

        function hideAllScreens() {
            const screens = ['loginScreen', 'registerScreen', 'passwordResetScreen', 'adminLoginScreen', 'dashboardScreen', 'adminDashboard'];
            screens.forEach(screen => {
                document.getElementById(screen).classList.add('hidden');
            });
        }

        // Fun√ß√£o para carregar dados lembrados do login
        function loadRememberedLogin() {
            const rememberedData = JSON.parse(localStorage.getItem('volante_remembered_login') || '{}');
            if (rememberedData.cpf) {
                document.getElementById('loginCpf').value = rememberedData.cpf;
                document.getElementById('rememberLogin').checked = true;
            }
        }

        // Fun√ß√£o para salvar dados do login
        function saveLoginData(cpf, remember) {
            if (remember) {
                localStorage.setItem('volante_remembered_login', JSON.stringify({ cpf: cpf }));
            } else {
                localStorage.removeItem('volante_remembered_login');
            }
        }

        // Fun√ß√µes de autentica√ß√£o
        function handleLogin(e) {
            e.preventDefault();
            const cpf = document.getElementById('loginCpf').value;
            const password = document.getElementById('loginPassword').value;

            // Verificar se apenas o CPF foi preenchido
            if (cpf && !password) {
                // Verificar se o CPF existe no sistema
                const user = db.findOne('users', { cpf });
                
                if (!user) {
                    // CPF n√£o encontrado - informar e sugerir cadastro
                    showNotification('‚ùå CPF n√£o encontrado! Fa√ßa seu cadastro primeiro.', 'error');
                    
                    // Limpar campo CPF e focar nele
                    document.getElementById('loginCpf').value = '';
                    document.getElementById('loginCpf').focus();
                    return;
                } else {
                    // CPF encontrado - solicitar senha
                    showNotification(`‚úÖ CPF encontrado! Ol√°, ${user.name}! Digite sua senha.`, 'success');
                    
                    // Focar no campo senha
                    document.getElementById('loginPassword').focus();
                    return;
                }
            }

            // Verificar se ambos os campos est√£o preenchidos
            if (!cpf || !password) {
                showNotification('Por favor, preencha CPF e senha para fazer login!', 'warning');
                
                // Focar no primeiro campo vazio
                if (!cpf) {
                    document.getElementById('loginCpf').focus();
                } else {
                    document.getElementById('loginPassword').focus();
                }
                return;
            }

            // Ambos os campos preenchidos - fazer valida√ß√£o completa
            const user = db.findOne('users', { cpf });
            
            if (!user) {
                // CPF n√£o encontrado
                const shouldRegister = confirm(
                    '‚ùå CPF n√£o cadastrado!\n\n' +
                    'Este CPF n√£o possui cadastro no sistema.\n' +
                    'Voc√™ precisa fazer seu cadastro primeiro.\n\n' +
                    'Deseja ir para a tela de cadastro agora?\n' +
                    '(Seu CPF ser√° preenchido automaticamente)'
                );
                
                if (shouldRegister) {
                    // Ir para cadastro com CPF pr√©-preenchido
                    showRegister();
                    document.getElementById('regCpf').value = cpf;
                    document.getElementById('regName').focus();
                } else {
                    // Limpar campos e focar no CPF
                    document.getElementById('loginCpf').value = '';
                    document.getElementById('loginPassword').value = '';
                    document.getElementById('loginCpf').focus();
                }
                return;
            }

            // CPF existe, verificar senha
            if (user.password !== password) {
                showNotification(
                    `‚ùå Senha incorreta para ${user.name}! Verifique sua senha.`,
                    'error'
                );
                
                // Limpar apenas o campo senha e focar nele
                document.getElementById('loginPassword').value = '';
                document.getElementById('loginPassword').focus();
                return;
            }

            // Verificar se a conta est√° ativa
            if (!user.active) {
                showNotification(
                    `‚ö†Ô∏è Conta pausada! Ol√°, ${user.name}! Entre em contato com o suporte.`,
                    'warning'
                );
                return;
            }

            // Login bem-sucedido
            currentUser = user;
            document.getElementById('userWelcome').textContent = `Bem-vindo, ${user.name}!`;
            
            // Salvar dados se "lembrar login" estiver marcado
            const rememberLogin = document.getElementById('rememberLogin').checked;
            saveLoginData(cpf, rememberLogin);
            
            showDashboard();
            showNotification(`üéâ Login realizado com sucesso! Bem-vindo, ${user.name}!`, 'success');
            
            // Limpar formul√°rio
            document.getElementById('loginForm').reset();
            
            // Restaurar checkbox se estava marcado
            if (rememberLogin) {
                document.getElementById('rememberLogin').checked = true;
            }
        }

        function handleRegister(e) {
            e.preventDefault();
            const cpf = document.getElementById('regCpf').value;
            
            // Verificar se usu√°rio j√° existe
            if (db.findOne('users', { cpf })) {
                showNotification('Este CPF j√° possui cadastro no sistema!', 'error');
                return;
            }

            const newUser = db.insert('users', {
                name: document.getElementById('regName').value,
                cpf: cpf,
                age: document.getElementById('regAge').value,
                email: document.getElementById('regEmail').value,
                whatsapp: document.getElementById('regWhatsapp').value,
                password: document.getElementById('regPassword').value,
                platform: document.getElementById('regPlatform').value,
                active: true
            });
            
            showNotification('Cadastro realizado com sucesso!', 'success');
            showLogin();
        }

        function handlePasswordReset(e) {
            e.preventDefault();
            const email = document.getElementById('resetEmail').value;
            
            const user = db.findOne('users', { email });
            if (user) {
                showNotification(`Nova senha enviada para ${email}!`, 'success');
                showLogin();
            } else {
                showNotification('Email n√£o encontrado no sistema!', 'error');
            }
        }

        function handleAdminLogin(e) {
            e.preventDefault();
            const password = document.getElementById('adminPassword').value;
            
            if (password === 'jlb@1964') {
                showAdminDashboard();
            } else {
                alert('Senha de administrador incorreta!');
            }
        }

        function logout() {
            currentUser = null;
            showLogin();
        }

        // Fun√ß√µes de formata√ß√£o
        function formatCPF(e) {
            let value = e.target.value.replace(/\D/g, '');
            value = value.replace(/(\d{3})(\d)/, '$1.$2');
            value = value.replace(/(\d{3})(\d)/, '$1.$2');
            value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
            e.target.value = value;
        }

        // Valida√ß√£o de CPF em tempo real
        function validateCPFRealTime(e) {
            const cpf = e.target.value;
            const cpfInput = e.target;
            const messageDiv = document.getElementById('cpfValidationMessage');
            
            // S√≥ validar se o CPF estiver completo (11 d√≠gitos)
            if (cpf.replace(/\D/g, '').length === 11) {
                // Verificar se √© um CPF v√°lido
                if (!isValidCPF(cpf)) {
                    // CPF inv√°lido
                    cpfInput.className = 'w-full px-4 py-3 border-2 border-red-500 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all duration-300 bg-red-50';
                    messageDiv.className = 'mt-1 text-sm text-red-600';
                    messageDiv.textContent = '‚ùå CPF inv√°lido - Digite um CPF real';
                    messageDiv.classList.remove('hidden');
                    return;
                }

                // CPF v√°lido - verificar se existe no sistema
                const user = db.findOne('users', { cpf });
                
                if (user) {
                    // CPF encontrado no sistema
                    cpfInput.className = 'w-full px-4 py-3 border-2 border-green-500 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-300 bg-green-50';
                    messageDiv.className = 'mt-1 text-sm text-green-600';
                    messageDiv.textContent = `‚úÖ CPF encontrado - ${user.name}`;
                    messageDiv.classList.remove('hidden');
                } else {
                    // CPF v√°lido mas n√£o cadastrado
                    cpfInput.className = 'w-full px-4 py-3 border-2 border-red-500 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all duration-300 bg-red-50';
                    messageDiv.className = 'mt-1 text-sm text-red-600';
                    messageDiv.textContent = '‚ùå CPF n√£o cadastrado - Fa√ßa seu cadastro primeiro';
                    messageDiv.classList.remove('hidden');
                }
            } else {
                // CPF incompleto - resetar estilo
                cpfInput.className = 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-300';
                messageDiv.classList.add('hidden');
            }
        }

        // Fun√ß√£o para validar CPF
        function isValidCPF(cpf) {
            cpf = cpf.replace(/\D/g, '');
            
            if (cpf.length !== 11) return false;
            
            // Verificar se todos os d√≠gitos s√£o iguais
            if (/^(\d)\1{10}$/.test(cpf)) return false;
            
            // Validar primeiro d√≠gito verificador
            let sum = 0;
            for (let i = 0; i < 9; i++) {
                sum += parseInt(cpf.charAt(i)) * (10 - i);
            }
            let remainder = 11 - (sum % 11);
            if (remainder === 10 || remainder === 11) remainder = 0;
            if (remainder !== parseInt(cpf.charAt(9))) return false;
            
            // Validar segundo d√≠gito verificador
            sum = 0;
            for (let i = 0; i < 10; i++) {
                sum += parseInt(cpf.charAt(i)) * (11 - i);
            }
            remainder = 11 - (sum % 11);
            if (remainder === 10 || remainder === 11) remainder = 0;
            if (remainder !== parseInt(cpf.charAt(10))) return false;
            
            return true;
        }

        function formatWhatsApp(e) {
            let value = e.target.value.replace(/\D/g, '');
            value = value.replace(/(\d{2})(\d)/, '($1) $2');
            value = value.replace(/(\d{5})(\d)/, '$1-$2');
            e.target.value = value;
        }

        // Fun√ß√µes de abas
        function showTab(tabName) {
            // Esconder todas as abas
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // Remover classe ativa de todos os bot√µes
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('border-green-600', 'text-green-600');
                btn.classList.add('text-gray-500');
            });
            
            // Mostrar aba selecionada
            document.getElementById(tabName + 'Tab').classList.remove('hidden');
            
            // Ativar bot√£o correspondente
            event.target.classList.add('border-green-600', 'text-green-600');
            event.target.classList.remove('text-gray-500');

            if (tabName === 'analytics') {
                updateAnalytics();
            } else if (tabName === 'export') {
                // Definir per√≠odo padr√£o como este m√™s
                setQuickPeriod('month');
            }
        }

        function showAdminTab(tabName) {
            // Esconder todas as abas admin
            document.querySelectorAll('.admin-tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // Remover classe ativa de todos os bot√µes admin
            document.querySelectorAll('.admin-tab-btn').forEach(btn => {
                btn.classList.remove('border-red-600', 'text-red-600');
                btn.classList.add('text-gray-500');
            });
            
            // Mostrar aba selecionada
            document.getElementById('admin' + tabName.charAt(0).toUpperCase() + tabName.slice(1) + 'Tab').classList.remove('hidden');
            
            // Ativar bot√£o correspondente
            event.target.classList.add('border-red-600', 'text-red-600');
            event.target.classList.remove('text-gray-500');
        }

        // Fun√ß√µes de ganhos
        function handleAddEarning(e) {
            e.preventDefault();
            
            const earning = db.insert('earnings', {
                userId: currentUser.id,
                platform: document.getElementById('earningPlatform').value,
                amount: parseFloat(document.getElementById('earningAmount').value),
                date: document.getElementById('earningDate').value,
                type: document.getElementById('earningType').value
            });
            
            document.getElementById('earningsForm').reset();
            document.getElementById('earningDate').value = new Date().toISOString().split('T')[0];
            
            updateEarningsList();
            updateDashboardSummary();
            showNotification('üí∞ Ganho adicionado com sucesso!', 'success');
        }

        function updateEarningsList() {
            const userEarnings = db.find('earnings', { userId: currentUser.id })
                .sort((a, b) => new Date(b.date) - new Date(a.date));
            const list = document.getElementById('earningsList');
            
            if (userEarnings.length === 0) {
                list.innerHTML = '<p class="text-gray-500">Nenhum ganho registrado ainda.</p>';
                return;
            }

            list.innerHTML = userEarnings.slice(0, 5).map(earning => `
                <div class="flex justify-between items-center p-3 bg-green-50 rounded-lg">
                    <div>
                        <p class="font-semibold">${earning.platform} - ${earning.type}</p>
                        <p class="text-sm text-gray-600">${new Date(earning.date).toLocaleDateString('pt-BR')}</p>
                    </div>
                    <div class="flex items-center space-x-2">
                        <span class="font-bold text-green-600">R$ ${earning.amount.toFixed(2)}</span>
                        <button onclick="editEarning(${earning.id})" class="text-blue-600 hover:text-blue-800 text-sm">
                            ‚úèÔ∏è
                        </button>
                        <button onclick="deleteEarning(${earning.id})" class="text-red-600 hover:text-red-800 text-sm">
                            üóëÔ∏è
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Fun√ß√µes de despesas
        function handleAddExpense(e) {
            e.preventDefault();
            
            const expense = db.insert('expenses', {
                userId: currentUser.id,
                category: document.getElementById('expenseCategory').value,
                amount: parseFloat(document.getElementById('expenseAmount').value),
                date: document.getElementById('expenseDate').value,
                description: document.getElementById('expenseDescription').value
            });
            
            document.getElementById('expensesForm').reset();
            document.getElementById('expenseDate').value = new Date().toISOString().split('T')[0];
            
            updateExpensesList();
            updateDashboardSummary();
            showNotification('üí∏ Despesa adicionada com sucesso!', 'success');
        }

        function updateExpensesList() {
            const userExpenses = db.find('expenses', { userId: currentUser.id })
                .sort((a, b) => new Date(b.date) - new Date(a.date));
            const list = document.getElementById('expensesList');
            
            if (userExpenses.length === 0) {
                list.innerHTML = '<p class="text-gray-500">Nenhuma despesa registrada ainda.</p>';
                return;
            }

            list.innerHTML = userExpenses.slice(0, 5).map(expense => `
                <div class="flex justify-between items-center p-3 bg-red-50 rounded-lg">
                    <div>
                        <p class="font-semibold">${expense.category}</p>
                        <p class="text-sm text-gray-600">${expense.description || 'Sem descri√ß√£o'}</p>
                        <p class="text-xs text-gray-500">${new Date(expense.date).toLocaleDateString('pt-BR')}</p>
                    </div>
                    <div class="flex items-center space-x-2">
                        <span class="font-bold text-red-600">R$ ${expense.amount.toFixed(2)}</span>
                        <button onclick="editExpense(${expense.id})" class="text-blue-600 hover:text-blue-800 text-sm">
                            ‚úèÔ∏è
                        </button>
                        <button onclick="deleteExpense(${expense.id})" class="text-red-600 hover:text-red-800 text-sm">
                            üóëÔ∏è
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Fun√ß√µes de cofres com valida√ß√£o de saldo
        function handleAddSaving(e) {
            e.preventDefault();
            
            const amount = parseFloat(document.getElementById('savingAmount').value);
            const availableBalance = db.getAvailableBalance(currentUser.id);
            
            // Verificar se h√° saldo suficiente
            if (amount > availableBalance) {
                showNotification(
                    `‚ùå Saldo insuficiente! Voc√™ tem R$ ${availableBalance.toFixed(2)} dispon√≠vel para guardar.`,
                    'error'
                );
                return;
            }
            
            if (amount <= 0) {
                showNotification('‚ùå O valor deve ser maior que zero!', 'error');
                return;
            }
            
            const saving = db.insert('savings', {
                userId: currentUser.id,
                amount: amount,
                purpose: document.getElementById('savingPurpose').value,
                goal: parseFloat(document.getElementById('savingGoal').value) || null,
                notes: document.getElementById('savingNotes').value,
                date: new Date().toISOString().split('T')[0],
                type: 'deposit' // Tipo para identificar dep√≥sitos vs retiradas
            });
            
            document.getElementById('savingsForm').reset();
            updateSavingsSummary();
            updateSavingsHistory();
            updateDashboardSummary();
            showNotification(`üí∞ R$ ${amount.toFixed(2)} guardado no cofre com sucesso!`, 'success');
        }

        function updateSavingsSummary() {
            const purposeGroups = db.getSavingsByPurpose(currentUser.id);
            const summary = document.getElementById('savingsSummary');
            const totalElement = document.getElementById('totalSavingsAmount');
            
            // Calcular total geral
            const totalAmount = db.getTotalSavings(currentUser.id);
            if (totalElement) {
                totalElement.textContent = `R$ ${totalAmount.toFixed(2)}`;
            }
            
            if (Object.keys(purposeGroups).length === 0) {
                summary.innerHTML = '<div class="col-span-full text-center text-gray-500 py-8">Nenhum cofre criado ainda. Comece guardando dinheiro!</div>';
                return;
            }

            summary.innerHTML = Object.entries(purposeGroups).map(([purpose, data]) => {
                const progress = data.goal ? (data.total / data.goal) * 100 : 0;
                const emoji = purpose.includes('üö®') ? 'üö®' : 
                             purpose.includes('üîß') ? 'üîß' : 
                             purpose.includes('üìà') ? 'üìà' : 
                             purpose.includes('üöó') ? 'üöó' : 
                             purpose.includes('üõ°Ô∏è') ? 'üõ°Ô∏è' : 
                             purpose.includes('üèñÔ∏è') ? 'üèñÔ∏è' : 'üí∞';
                
                return `
                    <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-4 border border-blue-200">
                        <div class="flex items-center justify-between mb-2">
                            <h4 class="font-semibold text-blue-800 flex items-center">
                                <span class="text-xl mr-2">${emoji}</span>
                                ${purpose.replace(/[üö®üîßüìàüöóüõ°Ô∏èüèñÔ∏èüíº]/g, '').trim()}
                            </h4>
                            <button onclick="withdrawFromSaving('${purpose}')" class="text-red-500 hover:text-red-700 text-sm">
                                üí∏ Retirar
                            </button>
                        </div>
                        <p class="text-2xl font-bold text-blue-600 mb-2">R$ ${data.total.toFixed(2)}</p>
                        ${data.goal ? `
                            <div class="mb-2">
                                <div class="flex justify-between text-xs text-gray-600 mb-1">
                                    <span>Meta: R$ ${data.goal.toFixed(2)}</span>
                                    <span>${progress.toFixed(1)}%</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="bg-blue-600 h-2 rounded-full transition-all duration-300" 
                                         style="width: ${Math.min(progress, 100)}%"></div>
                                </div>
                            </div>
                        ` : ''}
                        <p class="text-xs text-gray-600">${data.items.length} movimenta√ß√£o${data.items.length > 1 ? '√µes' : ''}</p>
                    </div>
                `;
            }).join('');
        }

        function updateSavingsHistory() {
            const userSavings = db.find('savings', { userId: currentUser.id })
                .sort((a, b) => new Date(b.date) - new Date(a.date));
            const history = document.getElementById('savingsHistory');
            
            if (userSavings.length === 0) {
                history.innerHTML = '<p class="text-gray-500 text-center py-4">Nenhuma movimenta√ß√£o ainda.</p>';
                return;
            }

            history.innerHTML = userSavings.slice(0, 10).map(saving => `
                <div class="flex justify-between items-center p-3 ${saving.amount > 0 ? 'bg-blue-50 border-blue-200' : 'bg-green-50 border-green-200'} rounded-lg border">
                    <div>
                        <p class="font-semibold ${saving.amount > 0 ? 'text-blue-800' : 'text-green-800'}">${saving.purpose.replace(/[üö®üîßüìàüöóüõ°Ô∏èüèñÔ∏èüíº]/g, '').trim()}</p>
                        <p class="text-sm text-gray-600">${new Date(saving.date).toLocaleDateString('pt-BR')}</p>
                        ${saving.notes ? `<p class="text-xs text-gray-500">${saving.notes}</p>` : ''}
                    </div>
                    <div class="text-right">
                        <span class="font-bold ${saving.amount > 0 ? 'text-blue-600' : 'text-green-600'}">
                            ${saving.amount > 0 ? '+' : ''} R$ ${Math.abs(saving.amount).toFixed(2)}
                        </span>
                        <div class="flex space-x-1 mt-1">
                            ${saving.amount > 0 ? `
                                <button onclick="editSaving(${saving.id})" class="text-blue-600 hover:text-blue-800 text-xs">
                                    ‚úèÔ∏è
                                </button>
                            ` : ''}
                            <button onclick="deleteSaving(${saving.id})" class="text-red-600 hover:text-red-800 text-xs">
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function withdrawFromSaving(purpose) {
            const purposeGroups = db.getSavingsByPurpose(currentUser.id);
            const purposeData = purposeGroups[purpose];
            
            if (!purposeData || purposeData.total <= 0) {
                showNotification('Este cofre est√° vazio!', 'warning');
                return;
            }

            const amount = prompt(`Cofre: ${purpose.replace(/[üö®üîßüìàüöóüõ°Ô∏èüèñÔ∏èüíº]/g, '').trim()}\nSaldo: R$ ${purposeData.total.toFixed(2)}\n\nQuanto deseja retirar?`);
            
            if (amount && !isNaN(amount) && parseFloat(amount) > 0) {
                const withdrawAmount = parseFloat(amount);
                
                if (withdrawAmount > purposeData.total) {
                    showNotification('Valor maior que o saldo dispon√≠vel!', 'error');
                    return;
                }

                // Criar registro de retirada (valor negativo) - volta para ganhos
                const withdrawal = db.insert('savings', {
                    userId: currentUser.id,
                    amount: -withdrawAmount,
                    purpose: purpose,
                    notes: `Retirada do cofre - valor retornado aos ganhos`,
                    date: new Date().toISOString().split('T')[0],
                    type: 'withdrawal'
                });

                // Criar ganho correspondente √† retirada
                const returnedEarning = db.insert('earnings', {
                    userId: currentUser.id,
                    platform: 'Cofre',
                    amount: withdrawAmount,
                    date: new Date().toISOString().split('T')[0],
                    type: 'Retirada do Cofre',
                    notes: `Valor retirado do cofre: ${purpose.replace(/[üö®üîßüìàüöóüõ°Ô∏èüèñÔ∏èüíº]/g, '').trim()}`
                });
                
                updateSavingsSummary();
                updateSavingsHistory();
                updateDashboardSummary();
                updateEarningsList();
                showNotification(`üí∏ R$ ${withdrawAmount.toFixed(2)} retirado do cofre e retornado aos ganhos!`, 'success');
            }
        }

        // Fun√ß√£o para atualizar resumo do dashboard
        function updateDashboardSummary() {
            if (!currentUser) return;
            
            const availableBalance = db.getAvailableBalance(currentUser.id);
            const availableBalanceEl = document.getElementById('availableBalance');
            
            if (availableBalanceEl) {
                availableBalanceEl.textContent = `R$ ${availableBalance.toFixed(2)}`;
                availableBalanceEl.className = availableBalance >= 0 ? 
                    'text-lg font-bold text-green-600' : 
                    'text-lg font-bold text-red-600';
            }
        }

        function editSaving(id) {
            const saving = db.findOne('savings', { id });
            if (saving && saving.amount > 0) { // S√≥ editar dep√≥sitos, n√£o retiradas
                document.getElementById('savingAmount').value = saving.amount;
                document.getElementById('savingPurpose').value = saving.purpose;
                document.getElementById('savingGoal').value = saving.goal || '';
                document.getElementById('savingNotes').value = saving.notes || '';
                
                // Remover o registro original
                db.delete('savings', id);
                updateSavingsSummary();
                updateSavingsHistory();
                updateDashboardSummary();
                
                showNotification('Movimenta√ß√£o carregada para edi√ß√£o. Fa√ßa as altera√ß√µes e clique em "Guardar no Cofre".', 'info');
            }
        }

        function deleteSaving(id) {
            if (confirm('Tem certeza que deseja excluir esta movimenta√ß√£o?')) {
                const saving = db.findOne('savings', { id });
                
                // Se for uma retirada (valor negativo), criar ganho correspondente
                if (saving && saving.amount < 0) {
                    db.insert('earnings', {
                        userId: currentUser.id,
                        platform: 'Cofre',
                        amount: Math.abs(saving.amount),
                        date: new Date().toISOString().split('T')[0],
                        type: 'Cancelamento de Retirada',
                        notes: `Cancelamento da retirada do cofre: ${saving.purpose}`
                    });
                    updateEarningsList();
                }
                
                db.delete('savings', id);
                updateSavingsSummary();
                updateSavingsHistory();
                updateDashboardSummary();
                showNotification('Movimenta√ß√£o exclu√≠da com sucesso!', 'success');
            }
        }

        // Fun√ß√£o para atualizar per√≠odo das an√°lises
        function updateAnalyticsPeriod() {
            const period = document.getElementById('analyticsPeriod').value;
            const monthInput = document.getElementById('analyticsMonth');
            const summaryTitle = document.getElementById('summaryTitle');
            
            // Atualizar t√≠tulo baseado no per√≠odo
            const titles = {
                'daily': 'üìÖ Resumo Di√°rio',
                'weekly': 'üìä Resumo Semanal', 
                'monthly': 'üìà Resumo Mensal',
                'yearly': 'üóìÔ∏è Resumo Anual'
            };
            
            summaryTitle.textContent = titles[period] || 'Resumo';
            
            // Configurar seletor baseado no per√≠odo
            if (period === 'daily') {
                monthInput.type = 'date';
                monthInput.placeholder = '';
                monthInput.value = new Date().toISOString().split('T')[0];
            } else if (period === 'weekly') {
                monthInput.type = 'date';
                monthInput.placeholder = 'Selecione uma data da semana';
                monthInput.value = new Date().toISOString().split('T')[0];
            } else if (period === 'yearly') {
                monthInput.type = 'number';
                monthInput.placeholder = 'Ano (ex: 2024)';
                monthInput.value = new Date().getFullYear();
            } else {
                monthInput.type = 'month';
                monthInput.placeholder = '';
                monthInput.value = new Date().toISOString().slice(0, 7);
            }
            
            // Atualizar an√°lises com novo per√≠odo
            updateAnalytics();
        }

        // Fun√ß√µes de an√°lises
        function updateAnalytics() {
            const period = document.getElementById('analyticsPeriod').value;
            const selectedDate = document.getElementById('analyticsMonth').value;
            
            // Filtrar dados baseado no per√≠odo selecionado
            const filteredEarnings = filterDataByPeriod(db.find('earnings', { userId: currentUser.id }), period, selectedDate);
            const filteredExpenses = filterDataByPeriod(db.find('expenses', { userId: currentUser.id }), period, selectedDate);
            const filteredSavings = filterDataByPeriod(db.find('savings', { userId: currentUser.id }), period, selectedDate);

            const totalEarnings = filteredEarnings.reduce((sum, e) => sum + e.amount, 0);
            const totalExpenses = filteredExpenses.reduce((sum, e) => sum + e.amount, 0);
            const totalSavingsDeposits = filteredSavings.filter(s => s.amount > 0).reduce((sum, s) => sum + s.amount, 0);
            const availableBalance = totalEarnings - totalExpenses - totalSavingsDeposits;

            document.getElementById('totalEarnings').textContent = `R$ ${totalEarnings.toFixed(2)}`;
            document.getElementById('totalExpenses').textContent = `R$ ${totalExpenses.toFixed(2)}`;
            document.getElementById('totalSavings').textContent = `R$ ${totalSavingsDeposits.toFixed(2)}`;
            
            const profitElement = document.getElementById('netProfit');
            profitElement.textContent = `R$ ${availableBalance.toFixed(2)}`;
            profitElement.className = availableBalance >= 0 ? 'font-bold text-green-600' : 'font-bold text-red-600';

            // Atualizar gr√°fico
            updateChart();
        }

        // Fun√ß√£o para filtrar dados por per√≠odo
        function filterDataByPeriod(data, period, selectedDate) {
            if (!selectedDate) return data;
            
            return data.filter(item => {
                const itemDate = new Date(item.date);
                
                switch (period) {
                    case 'daily':
                        const selected = new Date(selectedDate);
                        return itemDate.getFullYear() === selected.getFullYear() &&
                               itemDate.getMonth() === selected.getMonth() &&
                               itemDate.getDate() === selected.getDate();
                    
                    case 'weekly':
                        const weekSelected = new Date(selectedDate);
                        const weekStart = new Date(weekSelected);
                        weekStart.setDate(weekSelected.getDate() - weekSelected.getDay());
                        const weekEnd = new Date(weekStart);
                        weekEnd.setDate(weekStart.getDate() + 6);
                        return itemDate >= weekStart && itemDate <= weekEnd;
                    
                    case 'monthly':
                        const monthSelected = new Date(selectedDate);
                        return itemDate.getFullYear() === monthSelected.getFullYear() && 
                               itemDate.getMonth() === monthSelected.getMonth();
                    
                    case 'yearly':
                        const year = parseInt(selectedDate);
                        return itemDate.getFullYear() === year;
                    
                    default:
                        return true;
                }
            });
        }

        function updateChart() {
            const ctx = document.getElementById('monthlyChart');
            if (!ctx) return;
            
            // Destruir gr√°fico existente se houver
            if (window.monthlyChart) {
                window.monthlyChart.destroy();
            }

            const period = document.getElementById('analyticsPeriod')?.value || 'monthly';
            const selectedDate = document.getElementById('analyticsMonth')?.value;
            
            // Filtrar dados baseado no per√≠odo selecionado
            const filteredEarnings = filterDataByPeriod(db.find('earnings', { userId: currentUser.id }), period, selectedDate);
            const filteredExpenses = filterDataByPeriod(db.find('expenses', { userId: currentUser.id }), period, selectedDate);
            const filteredSavings = filterDataByPeriod(db.find('savings', { userId: currentUser.id }), period, selectedDate);

            const totalEarnings = filteredEarnings.reduce((sum, e) => sum + e.amount, 0);
            const totalExpenses = filteredExpenses.reduce((sum, e) => sum + e.amount, 0);
            const totalSavingsDeposits = filteredSavings.filter(s => s.amount > 0).reduce((sum, s) => sum + s.amount, 0);

            // Se n√£o h√° dados, mostrar gr√°fico vazio
            if (totalEarnings === 0 && totalExpenses === 0 && totalSavingsDeposits === 0) {
                window.monthlyChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Sem dados'],
                        datasets: [{
                            data: [1],
                            backgroundColor: ['#e5e7eb'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                enabled: false
                            }
                        }
                    }
                });
                return;
            }

            // Preparar dados para o gr√°fico
            const chartData = [];
            const chartLabels = [];
            const chartColors = [];

            if (totalEarnings > 0) {
                chartData.push(totalEarnings);
                chartLabels.push(`Ganhos`);
                chartColors.push('#10b981');
            }

            if (totalExpenses > 0) {
                chartData.push(totalExpenses);
                chartLabels.push(`Despesas`);
                chartColors.push('#ef4444');
            }

            if (totalSavingsDeposits > 0) {
                chartData.push(totalSavingsDeposits);
                chartLabels.push(`Cofres`);
                chartColors.push('#3b82f6');
            }

            window.monthlyChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: chartLabels,
                    datasets: [{
                        data: chartData,
                        backgroundColor: chartColors,
                        borderWidth: 3,
                        borderColor: '#ffffff',
                        hoverBorderWidth: 4,
                        hoverBorderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '60%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 15,
                                usePointStyle: true,
                                pointStyle: 'circle',
                                font: {
                                    size: 11,
                                    weight: '500'
                                },
                                generateLabels: function(chart) {
                                    const data = chart.data;
                                    return data.labels.map((label, i) => ({
                                        text: `${label}: R$ ${data.datasets[0].data[i].toFixed(2)}`,
                                        fillStyle: data.datasets[0].backgroundColor[i],
                                        strokeStyle: data.datasets[0].backgroundColor[i],
                                        lineWidth: 0,
                                        pointStyle: 'circle',
                                        hidden: false,
                                        index: i
                                    }));
                                }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#ffffff',
                            bodyColor: '#ffffff',
                            borderColor: '#ffffff',
                            borderWidth: 1,
                            cornerRadius: 8,
                            displayColors: true,
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `${label}: R$ ${value.toFixed(2)} (${percentage}%)`;
                                }
                            }
                        }
                    },
                    animation: {
                        animateRotate: true,
                        animateScale: true,
                        duration: 1200,
                        easing: 'easeOutQuart'
                    },
                    interaction: {
                        intersect: false,
                        mode: 'nearest'
                    },
                    onHover: (event, elements) => {
                        event.native.target.style.cursor = elements.length > 0 ? 'pointer' : 'default';
                    }
                }
            });
        }

        // Fun√ß√µes de metas
        function handleAddGoal(e) {
            e.preventDefault();
            
            const goal = {
                id: Date.now(),
                userId: currentUser.id,
                name: document.getElementById('goalName').value,
                amount: parseFloat(document.getElementById('goalAmount').value),
                date: document.getElementById('goalDate').value,
                category: document.getElementById('goalCategory').value,
                description: document.getElementById('goalDescription').value,
                currentAmount: 0,
                completed: false,
                createdDate: new Date().toISOString().split('T')[0]
            };

            goals.push(goal);
            localStorage.setItem('volante_goals', JSON.stringify(goals));
            
            document.getElementById('goalsForm').reset();
            document.getElementById('goalDate').value = new Date(Date.now() + 30*24*60*60*1000).toISOString().split('T')[0];
            updateGoalsList();
            alert('üéØ Meta criada com sucesso!');
        }

        function updateGoalsList() {
            const userGoals = goals.filter(g => g.userId === currentUser.id);
            const list = document.getElementById('goalsList');
            
            if (userGoals.length === 0) {
                list.innerHTML = '<div class="text-center py-8 text-gray-500">Nenhuma meta definida ainda. Crie sua primeira meta!</div>';
                return;
            }

            list.innerHTML = userGoals.map(goal => {
                const progress = (goal.currentAmount / goal.amount) * 100;
                const daysLeft = Math.ceil((new Date(goal.date) - new Date()) / (1000 * 60 * 60 * 24));
                const isOverdue = daysLeft < 0;
                const isCompleted = goal.completed || progress >= 100;
                
                return `
                    <div class="bg-gradient-to-r from-purple-50 to-purple-100 rounded-lg p-6 border border-purple-200 ${isCompleted ? 'opacity-75' : ''}">
                        <div class="flex justify-between items-start mb-4">
                            <div class="flex-1">
                                <div class="flex items-center mb-2">
                                    <span class="text-2xl mr-3">${goal.category.includes('üöó') ? 'üöó' : goal.category.includes('üè†') ? 'üè†' : goal.category.includes('‚úàÔ∏è') ? '‚úàÔ∏è' : goal.category.includes('üìö') ? 'üìö' : goal.category.includes('üè•') ? 'üè•' : goal.category.includes('üíº') ? 'üíº' : 'üéØ'}</span>
                                    <h4 class="text-lg font-bold text-purple-800">${goal.name}</h4>
                                    ${isCompleted ? '<span class="ml-2 text-green-600 font-bold">‚úÖ CONCLU√çDA</span>' : ''}
                                </div>
                                <p class="text-sm text-gray-600 mb-2">${goal.description || 'Sem descri√ß√£o'}</p>
                                <div class="flex items-center space-x-4 text-sm text-gray-600">
                                    <span>Meta: R$ ${goal.amount.toFixed(2)}</span>
                                    <span>Atual: R$ ${goal.currentAmount.toFixed(2)}</span>
                                    <span class="${isOverdue ? 'text-red-600' : daysLeft <= 7 ? 'text-yellow-600' : 'text-gray-600'}">
                                        ${isOverdue ? `${Math.abs(daysLeft)} dias atrasado` : `${daysLeft} dias restantes`}
                                    </span>
                                </div>
                            </div>
                            <div class="flex space-x-2">
                                ${!isCompleted ? `<button onclick="addToGoal(${goal.id})" class="bg-green-500 text-white px-3 py-1 rounded text-sm hover:bg-green-600">üí∞ Adicionar</button>` : ''}
                                <button onclick="editGoal(${goal.id})" class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600">‚úèÔ∏è</button>
                                <button onclick="deleteGoal(${goal.id})" class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600">üóëÔ∏è</button>
                            </div>
                        </div>
                        
                        <div class="mb-2">
                            <div class="flex justify-between text-sm text-gray-600 mb-1">
                                <span>Progresso</span>
                                <span>${progress.toFixed(1)}%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-3">
                                <div class="bg-gradient-to-r from-purple-500 to-purple-600 h-3 rounded-full transition-all duration-500" 
                                     style="width: ${Math.min(progress, 100)}%"></div>
                            </div>
                        </div>
                        
                        <div class="text-xs text-gray-500">
                            Criada em ${new Date(goal.createdDate).toLocaleDateString('pt-BR')} ‚Ä¢ 
                            Prazo: ${new Date(goal.date).toLocaleDateString('pt-BR')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function addToGoal(goalId) {
            const goal = goals.find(g => g.id === goalId);
            if (!goal) return;

            const remaining = goal.amount - goal.currentAmount;
            const amount = prompt(`Meta: ${goal.name}\nFaltam: R$ ${remaining.toFixed(2)}\n\nQuanto deseja adicionar?`);
            
            if (amount && !isNaN(amount) && parseFloat(amount) > 0) {
                const addAmount = parseFloat(amount);
                goal.currentAmount += addAmount;
                
                if (goal.currentAmount >= goal.amount) {
                    goal.completed = true;
                    alert(`üéâ Parab√©ns! Voc√™ atingiu sua meta "${goal.name}"!`);
                }
                
                localStorage.setItem('volante_goals', JSON.stringify(goals));
                updateGoalsList();
            }
        }

        function editGoal(goalId) {
            const goal = goals.find(g => g.id === goalId);
            if (!goal) return;

            document.getElementById('goalName').value = goal.name;
            document.getElementById('goalAmount').value = goal.amount;
            document.getElementById('goalDate').value = goal.date;
            document.getElementById('goalCategory').value = goal.category;
            document.getElementById('goalDescription').value = goal.description;
            
            // Remover meta original
            goals = goals.filter(g => g.id !== goalId);
            localStorage.setItem('volante_goals', JSON.stringify(goals));
            updateGoalsList();
            
            alert('Meta carregada para edi√ß√£o. Fa√ßa as altera√ß√µes e clique em "Criar Meta".');
        }

        function deleteGoal(goalId) {
            if (confirm('Tem certeza que deseja excluir esta meta?')) {
                goals = goals.filter(g => g.id !== goalId);
                localStorage.setItem('volante_goals', JSON.stringify(goals));
                updateGoalsList();
                alert('Meta exclu√≠da com sucesso!');
            }
        }

        // Fun√ß√µes do dashboard
        function updateDashboard() {
            updateEarningsList();
            updateExpensesList();
            updateSavingsSummary();
            updateSavingsHistory();
            updateGoalsList();
            loadSupportersList();
            updateExportCounts();
            updateDashboardSummary();
            updateMainDashboard();
        }

        // Fun√ß√£o para atualizar dashboard principal
        function updateMainDashboard() {
            if (!currentUser) return;

            const userEarnings = db.find('earnings', { userId: currentUser.id });
            const userExpenses = db.find('expenses', { userId: currentUser.id });
            const userSavings = db.find('savings', { userId: currentUser.id });
            const userGoals = db.find('goals', { userId: currentUser.id });

            const totalEarnings = userEarnings.reduce((sum, e) => sum + e.amount, 0);
            const totalExpenses = userExpenses.reduce((sum, e) => sum + e.amount, 0);
            const totalSavingsDeposits = userSavings.filter(s => s.amount > 0).reduce((sum, s) => sum + s.amount, 0);
            const availableBalance = totalEarnings - totalExpenses - totalSavingsDeposits;

            // Atualizar cards
            document.getElementById('dashTotalEarnings').textContent = `R$ ${totalEarnings.toFixed(2)}`;
            document.getElementById('dashEarningsCount').textContent = `${userEarnings.length} registros`;
            
            document.getElementById('dashTotalExpenses').textContent = `R$ ${totalExpenses.toFixed(2)}`;
            document.getElementById('dashExpensesCount').textContent = `${userExpenses.length} registros`;
            
            document.getElementById('dashTotalSavings').textContent = `R$ ${totalSavingsDeposits.toFixed(2)}`;
            const savingsGroups = db.getSavingsByPurpose(currentUser.id);
            document.getElementById('dashSavingsCount').textContent = `${Object.keys(savingsGroups).length} cofres`;
            
            const balanceElement = document.getElementById('dashAvailableBalance');
            balanceElement.textContent = `R$ ${availableBalance.toFixed(2)}`;
            balanceElement.className = availableBalance >= 0 ? 'text-2xl font-bold' : 'text-2xl font-bold text-red-200';

            // Atualizar gr√°fico do dashboard
            updateDashboardChart();
            
            // Atualizar atividades recentes
            updateRecentActivities();
            
            // Atualizar metas em progresso
            updateDashGoalsProgress();
            
            // Atualizar ganhos por plataforma
            updateDashPlatformEarnings();
        }

        function updateDashboardChart() {
            const ctx = document.getElementById('dashboardChart');
            if (!ctx) return;
            
            // Destruir gr√°fico existente se houver
            if (window.dashChart) {
                window.dashChart.destroy();
            }

            const currentMonth = new Date().toISOString().slice(0, 7);
            const monthlyEarnings = filterDataByPeriod(db.find('earnings', { userId: currentUser.id }), 'monthly', currentMonth);
            const monthlyExpenses = filterDataByPeriod(db.find('expenses', { userId: currentUser.id }), 'monthly', currentMonth);
            const monthlySavings = filterDataByPeriod(db.find('savings', { userId: currentUser.id }), 'monthly', currentMonth);

            const totalEarnings = monthlyEarnings.reduce((sum, e) => sum + e.amount, 0);
            const totalExpenses = monthlyExpenses.reduce((sum, e) => sum + e.amount, 0);
            const totalSavingsDeposits = monthlySavings.filter(s => s.amount > 0).reduce((sum, s) => sum + s.amount, 0);

            if (totalEarnings === 0 && totalExpenses === 0 && totalSavingsDeposits === 0) {
                ctx.getContext('2d').clearRect(0, 0, ctx.width, ctx.height);
                const context = ctx.getContext('2d');
                context.font = '16px Arial';
                context.fillStyle = '#9CA3AF';
                context.textAlign = 'center';
                context.fillText('Nenhum dado este m√™s', ctx.width / 2, ctx.height / 2);
                return;
            }

            const chartData = [];
            const chartLabels = [];
            const chartColors = [];

            if (totalEarnings > 0) {
                chartData.push(totalEarnings);
                chartLabels.push('Ganhos');
                chartColors.push('#10b981');
            }

            if (totalExpenses > 0) {
                chartData.push(totalExpenses);
                chartLabels.push('Despesas');
                chartColors.push('#ef4444');
            }

            if (totalSavingsDeposits > 0) {
                chartData.push(totalSavingsDeposits);
                chartLabels.push('Cofres');
                chartColors.push('#3b82f6');
            }

            window.dashChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: chartLabels,
                    datasets: [{
                        data: chartData,
                        backgroundColor: chartColors,
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '60%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 10,
                                usePointStyle: true,
                                font: { size: 11 }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.parsed;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `${context.label}: R$ ${value.toFixed(2)} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateRecentActivities() {
            const container = document.getElementById('recentActivities');
            if (!container) return;

            const allActivities = [];
            
            // Adicionar ganhos recentes
            const recentEarnings = db.find('earnings', { userId: currentUser.id })
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 3);
            
            recentEarnings.forEach(earning => {
                allActivities.push({
                    type: 'earning',
                    date: earning.date,
                    description: `Ganho: ${earning.platform} - ${earning.type}`,
                    amount: earning.amount,
                    color: 'text-green-600',
                    icon: 'üí∞'
                });
            });

            // Adicionar despesas recentes
            const recentExpenses = db.find('expenses', { userId: currentUser.id })
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 3);
            
            recentExpenses.forEach(expense => {
                allActivities.push({
                    type: 'expense',
                    date: expense.date,
                    description: `Despesa: ${expense.category}`,
                    amount: expense.amount,
                    color: 'text-red-600',
                    icon: 'üí∏'
                });
            });

            // Adicionar movimenta√ß√µes de cofres recentes
            const recentSavings = db.find('savings', { userId: currentUser.id })
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 2);
            
            recentSavings.forEach(saving => {
                allActivities.push({
                    type: 'saving',
                    date: saving.date,
                    description: saving.amount > 0 ? `Guardado no cofre: ${saving.purpose}` : `Retirado do cofre: ${saving.purpose}`,
                    amount: Math.abs(saving.amount),
                    color: saving.amount > 0 ? 'text-blue-600' : 'text-green-600',
                    icon: saving.amount > 0 ? 'üè¶' : 'üí∏'
                });
            });

            // Ordenar por data e pegar os 5 mais recentes
            allActivities.sort((a, b) => new Date(b.date) - new Date(a.date));
            const recentActivities = allActivities.slice(0, 5);

            if (recentActivities.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-4">Nenhuma atividade recente</p>';
                return;
            }

            container.innerHTML = recentActivities.map(activity => `
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                    <div class="flex items-center space-x-3">
                        <span class="text-xl">${activity.icon}</span>
                        <div>
                            <p class="text-sm font-medium text-gray-800">${activity.description}</p>
                            <p class="text-xs text-gray-500">${new Date(activity.date).toLocaleDateString('pt-BR')}</p>
                        </div>
                    </div>
                    <span class="font-semibold ${activity.color}">R$ ${activity.amount.toFixed(2)}</span>
                </div>
            `).join('');
        }

        function updateDashGoalsProgress() {
            const container = document.getElementById('dashGoalsProgress');
            if (!container) return;

            const userGoals = db.find('goals', { userId: currentUser.id })
                .filter(g => !g.completed)
                .slice(0, 3);

            if (userGoals.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-4">Nenhuma meta em progresso</p>';
                return;
            }

            container.innerHTML = userGoals.map(goal => {
                const progress = (goal.currentAmount / goal.amount) * 100;
                const daysLeft = Math.ceil((new Date(goal.date) - new Date()) / (1000 * 60 * 60 * 24));
                
                return `
                    <div class="p-3 bg-purple-50 rounded-lg border border-purple-200">
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="font-medium text-purple-800">${goal.name}</h4>
                            <span class="text-xs text-purple-600">${daysLeft}d restantes</span>
                        </div>
                        <div class="mb-2">
                            <div class="flex justify-between text-xs text-gray-600 mb-1">
                                <span>R$ ${goal.currentAmount.toFixed(2)}</span>
                                <span>R$ ${goal.amount.toFixed(2)}</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-purple-600 h-2 rounded-full" style="width: ${Math.min(progress, 100)}%"></div>
                            </div>
                        </div>
                        <p class="text-xs text-gray-600">${progress.toFixed(1)}% conclu√≠do</p>
                    </div>
                `;
            }).join('');
        }

        function updateDashPlatformEarnings() {
            const container = document.getElementById('dashPlatformEarnings');
            if (!container) return;

            const userEarnings = db.find('earnings', { userId: currentUser.id });
            
            if (userEarnings.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-4">Nenhum ganho registrado</p>';
                return;
            }

            const platformTotals = userEarnings.reduce((acc, earning) => {
                acc[earning.platform] = (acc[earning.platform] || 0) + earning.amount;
                return acc;
            }, {});

            const sortedPlatforms = Object.entries(platformTotals)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 4);

            const totalEarnings = Object.values(platformTotals).reduce((sum, amount) => sum + amount, 0);

            container.innerHTML = sortedPlatforms.map(([platform, amount]) => {
                const percentage = ((amount / totalEarnings) * 100).toFixed(1);
                
                return `
                    <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg border border-green-200">
                        <div>
                            <h4 class="font-medium text-green-800">${platform}</h4>
                            <p class="text-xs text-green-600">${percentage}% do total</p>
                        </div>
                        <span class="font-semibold text-green-600">R$ ${amount.toFixed(2)}</span>
                    </div>
                `;
            }).join('');
        }

        // Fun√ß√µes administrativas
        function loadUsersList() {
            const list = document.getElementById('usersList');
            
            if (users.length === 0) {
                list.innerHTML = '<p class="text-gray-500">Nenhum usu√°rio cadastrado.</p>';
                return;
            }

            list.innerHTML = users.map(user => `
                <div class="flex justify-between items-center p-4 border rounded-lg ${user.active ? 'bg-white' : 'bg-gray-100'}">
                    <div>
                        <p class="font-semibold">${user.name}</p>
                        <p class="text-sm text-gray-600">${user.cpf} - ${user.email}</p>
                        <p class="text-xs text-gray-500">${user.whatsapp || 'WhatsApp n√£o informado'} - ${user.platform} - ${user.age} anos</p>
                    </div>
                    <div class="flex space-x-2">
                        <button onclick="sendWhatsAppNotification(${user.id})" 
                                class="px-3 py-1 bg-green-500 text-white rounded text-sm hover:bg-green-600">
                            WhatsApp
                        </button>
                        <button onclick="toggleUserStatus(${user.id})" 
                                class="px-3 py-1 rounded text-sm ${user.active ? 'bg-yellow-500 text-white' : 'bg-green-500 text-white'}">
                            ${user.active ? 'Pausar' : 'Ativar'}
                        </button>
                        <button onclick="deleteUser(${user.id})" 
                                class="px-3 py-1 bg-red-500 text-white rounded text-sm hover:bg-red-600">
                            Excluir
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function showAddUserForm() {
            document.getElementById('addUserModal').classList.remove('hidden');
        }

        function hideAddUserForm() {
            document.getElementById('addUserModal').classList.add('hidden');
            document.getElementById('adminAddUserForm').reset();
        }

        function handleAdminAddUser(e) {
            e.preventDefault();
            
            const cpf = document.getElementById('adminUserCpf').value;
            
            if (users.find(u => u.cpf === cpf)) {
                alert('Este CPF j√° possui cadastro no sistema!');
                return;
            }

            const newUser = {
                id: Date.now(),
                name: document.getElementById('adminUserName').value,
                cpf: cpf,
                age: document.getElementById('adminUserAge').value,
                email: document.getElementById('adminUserEmail').value,
                whatsapp: document.getElementById('adminUserWhatsapp').value,
                password: document.getElementById('adminUserPassword').value,
                platform: document.getElementById('adminUserPlatform').value,
                active: true
            };

            users.push(newUser);
            localStorage.setItem('volante_users', JSON.stringify(users));
            
            hideAddUserForm();
            loadUsersList();
            alert('Usu√°rio adicionado com sucesso!');
        }

        function toggleUserStatus(userId) {
            const user = users.find(u => u.id === userId);
            if (user) {
                user.active = !user.active;
                localStorage.setItem('volante_users', JSON.stringify(users));
                loadUsersList();
            }
        }

        function deleteUser(userId) {
            if (confirm('Tem certeza que deseja excluir este usu√°rio?')) {
                users = users.filter(u => u.id !== userId);
                localStorage.setItem('volante_users', JSON.stringify(users));
                loadUsersList();
                alert('Usu√°rio exclu√≠do com sucesso!');
            }
        }

        // Fun√ß√µes administrativas adicionais
        function handleGeneratePassword(e) {
            e.preventDefault();
            const userId = document.getElementById('userSelectPassword').value;
            
            if (!userId) {
                alert('Selecione um usu√°rio!');
                return;
            }

            const user = users.find(u => u.id == userId);
            if (user) {
                const newPassword = generateRandomPassword();
                user.password = newPassword;
                localStorage.setItem('volante_users', JSON.stringify(users));
                
                // Mostrar op√ß√µes para o administrador
                const sendWhatsApp = confirm(`Nova senha gerada para ${user.name}: ${newPassword}\n\nDeseja enviar esta senha via WhatsApp?`);
                
                if (sendWhatsApp && user.whatsapp) {
                    const message = `Ol√° ${user.name}! Sua nova senha do Volante Financeiro √©: ${newPassword}\n\nGuarde esta senha em local seguro.`;
                    const whatsappUrl = `https://wa.me/55${user.whatsapp.replace(/\D/g, '')}?text=${encodeURIComponent(message)}`;
                    window.open(whatsappUrl, '_blank');
                    alert('Senha gerada e enviada via WhatsApp!');
                } else if (sendWhatsApp && !user.whatsapp) {
                    alert('WhatsApp n√£o cadastrado para este usu√°rio!');
                } else {
                    alert('Nova senha gerada com sucesso!');
                }
                
                document.getElementById('generatePasswordForm').reset();
                updateUserSelectOptions();
            }
        }

        function generateRandomPassword() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            let password = '';
            for (let i = 0; i < 8; i++) {
                password += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return password;
        }

        function updateUserSelectOptions() {
            const select = document.getElementById('userSelectPassword');
            select.innerHTML = '<option value="">Selecione um usu√°rio...</option>';
            
            users.forEach(user => {
                const option = document.createElement('option');
                option.value = user.id;
                option.textContent = `${user.name} - ${user.cpf}`;
                select.appendChild(option);
            });
        }

        function sendWhatsAppNotification(userId) {
            const user = users.find(u => u.id === userId);
            if (user && user.whatsapp) {
                const message = `Ol√° ${user.name}! Voc√™ tem atualiza√ß√µes no Volante Financeiro. Acesse o app para mais informa√ß√µes.`;
                const whatsappUrl = `https://wa.me/55${user.whatsapp.replace(/\D/g, '')}?text=${encodeURIComponent(message)}`;
                window.open(whatsappUrl, '_blank');
            } else {
                alert('WhatsApp n√£o cadastrado para este usu√°rio!');
            }
        }

        // Fun√ß√µes de upload de imagem
        function handleAppLogoUpload(e) {
            const file = e.target.files[0];
            if (file) {
                if (file.size > 2 * 1024 * 1024) {
                    alert('Arquivo muito grande! M√°ximo 2MB.');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(event) {
                    const imageUrl = event.target.result;
                    
                    // Atualizar preview no admin
                    const adminPreview = document.getElementById('adminAppLogoPreview');
                    adminPreview.innerHTML = `<img src="${imageUrl}" alt="Logo" class="w-full h-full object-cover rounded-full">`;
                    
                    // Atualizar logo no dashboard principal
                    const appLogo = document.getElementById('appLogoDisplay');
                    if (appLogo) {
                        appLogo.innerHTML = `<img src="${imageUrl}" alt="Logo" class="w-full h-full object-cover rounded-full">`;
                    }
                    
                    // Salvar no localStorage
                    localStorage.setItem('volante_app_logo', imageUrl);
                    
                    alert('Logo do aplicativo atualizada com sucesso!');
                };
                reader.readAsDataURL(file);
            }
        }

        let tempDevLogo = null;
        let tempAboutLogo = null;

        function handleDevLogoUpload(e) {
            const file = e.target.files[0];
            if (file) {
                // Verificar tipo de arquivo
                if (!file.type.match(/^image\/(png|jpeg)$/)) {
                    alert('Formato n√£o suportado! Use apenas PNG ou JPEG.');
                    return;
                }

                if (file.size > 2 * 1024 * 1024) {
                    alert('Arquivo muito grande! M√°ximo 2MB.');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(event) {
                    tempDevLogo = event.target.result;
                    
                    // Mostrar preview
                    const preview = document.getElementById('devLogoPreview');
                    preview.innerHTML = `<img src="${tempDevLogo}" alt="Logo Preview" class="w-full h-full object-cover rounded-lg">`;
                    
                    // Habilitar bot√£o salvar
                    document.getElementById('saveDevLogoBtn').disabled = false;
                };
                reader.readAsDataURL(file);
            }
        }

        function saveDevLogo() {
            if (tempDevLogo) {
                localStorage.setItem('volante_dev_logo', tempDevLogo);
                alert('Logo do desenvolvedor salva com sucesso!');
                
                // Desabilitar bot√£o salvar
                document.getElementById('saveDevLogoBtn').disabled = true;
                tempDevLogo = null;
            }
        }

        function handleAboutLogoUpload(e) {
            const file = e.target.files[0];
            if (file) {
                // Verificar tipo de arquivo
                if (!file.type.match(/^image\/(png|jpeg)$/)) {
                    showNotification('Formato n√£o suportado! Use apenas PNG ou JPEG.', 'error');
                    return;
                }

                if (file.size > 2 * 1024 * 1024) {
                    showNotification('Arquivo muito grande! M√°ximo 2MB.', 'error');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(event) {
                    tempAboutLogo = event.target.result;
                    
                    // Mostrar preview
                    const preview = document.getElementById('aboutLogoPreview');
                    preview.innerHTML = `<img src="${tempAboutLogo}" alt="Logo Sobre Preview" class="w-full h-full object-cover rounded-full">`;
                    
                    // Habilitar bot√£o salvar
                    document.getElementById('saveAboutLogoBtn').disabled = false;
                    
                    showNotification('Logo carregado! Clique em "Salvar" para aplicar.', 'info');
                };
                reader.readAsDataURL(file);
            }
        }

        function saveAboutLogo() {
            if (tempAboutLogo) {
                localStorage.setItem('volante_about_logo', tempAboutLogo);
                
                // Atualizar logo na aba sobre
                const aboutPageLogo = document.getElementById('aboutPageLogo');
                if (aboutPageLogo) {
                    aboutPageLogo.innerHTML = `<img src="${tempAboutLogo}" alt="Logo Volante Financeiro" class="w-full h-full object-cover rounded-full">`;
                }
                
                showNotification('Logo da aba Sobre salvo com sucesso!', 'success');
                
                // Desabilitar bot√£o salvar
                document.getElementById('saveAboutLogoBtn').disabled = true;
                tempAboutLogo = null;
            }
        }

        // Fun√ß√µes de edi√ß√£o e exclus√£o
        function editEarning(id) {
            const earning = db.findOne('earnings', { id });
            if (earning) {
                document.getElementById('earningPlatform').value = earning.platform;
                document.getElementById('earningAmount').value = earning.amount;
                document.getElementById('earningDate').value = earning.date;
                document.getElementById('earningType').value = earning.type;
                
                // Remover o ganho original
                db.delete('earnings', id);
                updateEarningsList();
                updateDashboardSummary();
                
                showNotification('Ganho carregado para edi√ß√£o. Fa√ßa as altera√ß√µes e clique em "Adicionar Ganho".', 'info');
            }
        }

        function deleteEarning(id) {
            if (confirm('Tem certeza que deseja excluir este ganho?')) {
                db.delete('earnings', id);
                updateEarningsList();
                updateDashboardSummary();
                showNotification('Ganho exclu√≠do com sucesso!', 'success');
            }
        }

        function editExpense(id) {
            const expense = db.findOne('expenses', { id });
            if (expense) {
                document.getElementById('expenseCategory').value = expense.category;
                document.getElementById('expenseAmount').value = expense.amount;
                document.getElementById('expenseDate').value = expense.date;
                document.getElementById('expenseDescription').value = expense.description;
                
                // Remover a despesa original
                db.delete('expenses', id);
                updateExpensesList();
                updateDashboardSummary();
                
                showNotification('Despesa carregada para edi√ß√£o. Fa√ßa as altera√ß√µes e clique em "Adicionar Despesa".', 'info');
            }
        }

        function deleteExpense(id) {
            if (confirm('Tem certeza que deseja excluir esta despesa?')) {
                db.delete('expenses', id);
                updateExpensesList();
                updateDashboardSummary();
                showNotification('Despesa exclu√≠da com sucesso!', 'success');
            }
        }

        // Fun√ß√£o para editar informa√ß√µes sobre
        function handleEditAbout(e) {
            e.preventDefault();
            
            const aboutInfo = {
                projectDescription: document.getElementById('projectDescription').value,
                devTeam: document.getElementById('devTeam').value,
                teachers: document.getElementById('teachers').value,
                schoolName: document.getElementById('schoolName').value,
                systemVersion: document.getElementById('systemVersion').value
            };
            
            localStorage.setItem('volante_about_info', JSON.stringify(aboutInfo));
            updateAboutTab();
            alert('Informa√ß√µes da aba Sobre atualizadas com sucesso!');
        }

        // Fun√ß√£o para atualizar a aba sobre com as informa√ß√µes editadas
        function updateAboutTab() {
            const savedInfo = JSON.parse(localStorage.getItem('volante_about_info') || '{}');
            
            if (Object.keys(savedInfo).length > 0) {
                // Atualizar o conte√∫do da aba sobre
                const aboutContent = document.querySelector('#aboutTab .space-y-6');
                if (aboutContent) {
                    aboutContent.innerHTML = `
                        <div>
                            <h3 class="text-lg font-semibold text-gray-800 mb-3">Sobre o Projeto</h3>
                            <p class="text-gray-600 leading-relaxed">
                                ${savedInfo.projectDescription || 'O Volante Financeiro √© um aplicativo desenvolvido especialmente para motoristas de aplicativo e profissionais do transporte em Corumb√°-MS e Lad√°rio-MS. O sistema permite organizar despesas pessoais e operacionais, planejar ganhos, monitorar custos e otimizar a rentabilidade, adaptando-se √† realidade local da regi√£o.'}
                            </p>
                        </div>

                        <div>
                            <h3 class="text-lg font-semibold text-gray-800 mb-3">Desenvolvedores</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="bg-gray-50 p-4 rounded-lg">
                                    <h4 class="font-semibold text-green-700 mb-2">Equipe de Desenvolvimento</h4>
                                    <div class="text-sm text-gray-600 space-y-1">
                                        ${savedInfo.devTeam ? savedInfo.devTeam.split('\n').map(member => `<div>${member}</div>`).join('') : '<div>‚Ä¢ Jo√£o Victor Ribeiro de Souza</div><div>‚Ä¢ Odilon Chalis</div><div>‚Ä¢ Thaviny Maria Moraes de Toledo Soares</div><div>‚Ä¢ Wallace Kau√£ Samosa Coronel</div>'}
                                    </div>
                                </div>
                                <div class="bg-gray-50 p-4 rounded-lg">
                                    <h4 class="font-semibold text-green-700 mb-2">Professores Respons√°veis</h4>
                                    <div class="text-sm text-gray-600 space-y-1">
                                        ${savedInfo.teachers ? savedInfo.teachers.split('\n').map(teacher => `<div>${teacher}</div>`).join('') : '<div>‚Ä¢ Gabriela Luiza da Costa Neves</div><div>‚Ä¢ Wellington Cesar de Oliveira</div>'}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div>
                            <h3 class="text-lg font-semibold text-gray-800 mb-3">Funcionalidades</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <ul class="text-sm text-gray-600 space-y-2">
                                    <li class="flex items-center">
                                        <span class="w-2 h-2 bg-green-500 rounded-full mr-3"></span>
                                        Controle de ganhos por corrida/entrega
                                    </li>
                                    <li class="flex items-center">
                                        <span class="w-2 h-2 bg-green-500 rounded-full mr-3"></span>
                                        Gest√£o de despesas operacionais
                                    </li>
                                    <li class="flex items-center">
                                        <span class="w-2 h-2 bg-green-500 rounded-full mr-3"></span>
                                        Sistema de reservas financeiras
                                    </li>
                                    <li class="flex items-center">
                                        <span class="w-2 h-2 bg-green-500 rounded-full mr-3"></span>
                                        An√°lises e relat√≥rios detalhados
                                    </li>
                                </ul>
                                <ul class="text-sm text-gray-600 space-y-2">
                                    <li class="flex items-center">
                                        <span class="w-2 h-2 bg-green-500 rounded-full mr-3"></span>
                                        Suporte a m√∫ltiplas plataformas
                                    </li>
                                    <li class="flex items-center">
                                        <span class="w-2 h-2 bg-green-500 rounded-full mr-3"></span>
                                        Interface responsiva e intuitiva
                                    </li>
                                    <li class="flex items-center">
                                        <span class="w-2 h-2 bg-green-500 rounded-full mr-3"></span>
                                        Painel administrativo completo
                                    </li>
                                    <li class="flex items-center">
                                        <span class="w-2 h-2 bg-green-500 rounded-full mr-3"></span>
                                        Notifica√ß√µes via WhatsApp
                                    </li>
                                </ul>
                            </div>
                        </div>

                        <div class="text-center pt-6 border-t">
                            <p class="text-sm text-gray-500">
                                ${savedInfo.systemVersion || 'Vers√£o 1.0 - 2024'} | Desenvolvido com ‚ù§Ô∏è para a comunidade de motoristas
                            </p>
                        </div>
                    `;
                }
                
                // Atualizar rodap√©
                const footer = document.querySelector('footer p');
                if (footer) {
                    footer.innerHTML = `Desenvolvido por <strong>${savedInfo.schoolName || 'Escola Estadual Dr. Jo√£o Leite de Barros'}</strong>`;
                }
            }
        }

        // Carregar informa√ß√µes editadas da aba sobre
        function loadAboutInfo() {
            const savedInfo = JSON.parse(localStorage.getItem('volante_about_info') || '{}');
            
            if (Object.keys(savedInfo).length > 0) {
                document.getElementById('projectDescription').value = savedInfo.projectDescription || '';
                document.getElementById('devTeam').value = savedInfo.devTeam || '';
                document.getElementById('teachers').value = savedInfo.teachers || '';
                document.getElementById('schoolName').value = savedInfo.schoolName || '';
                document.getElementById('systemVersion').value = savedInfo.systemVersion || '';
            }
        }

        // Fun√ß√µes de apoiadores
        function loadSupportersList() {
            const list = document.getElementById('supportersList');
            
            if (supporters.length === 0) {
                list.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <div class="text-gray-400 mb-4">
                            <svg class="w-16 h-16 mx-auto" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                        </div>
                        <h3 class="text-lg font-semibold text-gray-600 mb-2">Ainda n√£o temos apoiadores</h3>
                        <p class="text-gray-500">Seja o primeiro a apoiar nosso projeto!</p>
                    </div>
                `;
                return;
            }

            // Agrupar por tipo de apoio
            const groupedSupporters = supporters.reduce((groups, supporter) => {
                const type = supporter.type || 'Apoiador';
                if (!groups[type]) groups[type] = [];
                groups[type].push(supporter);
                return groups;
            }, {});

            // Ordem de prioridade dos tipos
            const typeOrder = ['Patrocinador Principal', 'Patrocinador', 'Parceiro', 'Apoiador'];
            
            let html = '';
            typeOrder.forEach(type => {
                if (groupedSupporters[type]) {
                    html += `
                        <div class="col-span-full mb-6">
                            <h3 class="text-lg font-semibold text-green-800 mb-4 text-center">${type}${groupedSupporters[type].length > 1 ? 's' : ''}</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                ${groupedSupporters[type].map(supporter => `
                                    <div class="bg-white border rounded-lg p-6 text-center hover:shadow-lg transition-shadow">
                                        ${supporter.logo ? 
                                            `<img src="${supporter.logo}" alt="${supporter.name}" class="w-20 h-20 mx-auto mb-4 object-contain rounded-lg">` :
                                            `<div class="w-20 h-20 mx-auto mb-4 bg-green-100 rounded-lg flex items-center justify-center">
                                                <span class="text-green-600 font-bold text-xl">${supporter.name.charAt(0)}</span>
                                            </div>`
                                        }
                                        <h4 class="font-semibold text-gray-800 mb-2">${supporter.name}</h4>
                                        ${supporter.description ? `<p class="text-sm text-gray-600 mb-3">${supporter.description}</p>` : ''}
                                        <div class="flex justify-center space-x-2">
                                            ${supporter.website ? 
                                                `<a href="${supporter.website}" target="_blank" class="text-green-600 hover:text-green-800 text-sm">
                                                    üåê Website
                                                </a>` : ''
                                            }
                                            ${supporter.phone ? 
                                                `<a href="tel:${supporter.phone}" class="text-green-600 hover:text-green-800 text-sm">
                                                    üìû Contato
                                                </a>` : ''
                                            }
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }
            });

            list.innerHTML = html;
        }

        function loadAdminSupportersList() {
            const list = document.getElementById('adminSupportersList');
            
            if (supporters.length === 0) {
                list.innerHTML = '<p class="text-gray-500">Nenhum apoiador cadastrado.</p>';
                return;
            }

            list.innerHTML = supporters.map(supporter => `
                <div class="flex items-center justify-between p-4 border rounded-lg bg-white">
                    <div class="flex items-center space-x-4">
                        ${supporter.logo ? 
                            `<img src="${supporter.logo}" alt="${supporter.name}" class="w-12 h-12 object-contain rounded">` :
                            `<div class="w-12 h-12 bg-green-100 rounded flex items-center justify-center">
                                <span class="text-green-600 font-bold">${supporter.name.charAt(0)}</span>
                            </div>`
                        }
                        <div>
                            <h4 class="font-semibold">${supporter.name}</h4>
                            <p class="text-sm text-gray-600">${supporter.type}</p>
                            ${supporter.description ? `<p class="text-xs text-gray-500">${supporter.description.substring(0, 50)}${supporter.description.length > 50 ? '...' : ''}</p>` : ''}
                        </div>
                    </div>
                    <div class="flex space-x-2">
                        <button onclick="editSupporter(${supporter.id})" 
                                class="px-3 py-1 bg-blue-500 text-white rounded text-sm hover:bg-blue-600">
                            Editar
                        </button>
                        <button onclick="deleteSupporter(${supporter.id})" 
                                class="px-3 py-1 bg-red-500 text-white rounded text-sm hover:bg-red-600">
                            Excluir
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function showAddSupporterForm() {
            document.getElementById('addSupporterModal').classList.remove('hidden');
        }

        function hideAddSupporterForm() {
            document.getElementById('addSupporterModal').classList.add('hidden');
            document.getElementById('addSupporterForm').reset();
        }

        function handleAddSupporter(e) {
            e.preventDefault();
            
            const logoFile = document.getElementById('supporterLogo').files[0];
            
            if (logoFile) {
                if (logoFile.size > 2 * 1024 * 1024) {
                    alert('Logo muito grande! M√°ximo 2MB.');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(event) {
                    saveSupporterData(event.target.result);
                };
                reader.readAsDataURL(logoFile);
            } else {
                saveSupporterData(null);
            }
        }

        function saveSupporterData(logoData) {
            const newSupporter = {
                id: Date.now(),
                name: document.getElementById('supporterName').value,
                description: document.getElementById('supporterDescription').value,
                website: document.getElementById('supporterWebsite').value,
                phone: document.getElementById('supporterPhone').value,
                logo: logoData,
                type: document.getElementById('supporterType').value
            };

            supporters.push(newSupporter);
            localStorage.setItem('volante_supporters', JSON.stringify(supporters));
            
            hideAddSupporterForm();
            loadAdminSupportersList();
            loadSupportersList();
            alert('Apoiador adicionado com sucesso!');
        }

        function editSupporter(id) {
            const supporter = supporters.find(s => s.id === id);
            if (supporter) {
                document.getElementById('supporterName').value = supporter.name;
                document.getElementById('supporterDescription').value = supporter.description || '';
                document.getElementById('supporterWebsite').value = supporter.website || '';
                document.getElementById('supporterPhone').value = supporter.phone || '';
                document.getElementById('supporterType').value = supporter.type;
                
                // Remover o apoiador original para permitir edi√ß√£o
                supporters = supporters.filter(s => s.id !== id);
                localStorage.setItem('volante_supporters', JSON.stringify(supporters));
                
                showAddSupporterForm();
                alert('Apoiador carregado para edi√ß√£o. Fa√ßa as altera√ß√µes e clique em "Adicionar".');
            }
        }

        function deleteSupporter(id) {
            if (confirm('Tem certeza que deseja excluir este apoiador?')) {
                supporters = supporters.filter(s => s.id !== id);
                localStorage.setItem('volante_supporters', JSON.stringify(supporters));
                loadAdminSupportersList();
                loadSupportersList();
                alert('Apoiador exclu√≠do com sucesso!');
            }
        }

        function contactSupport() {
            const message = 'Ol√°! Gostaria de saber mais sobre como apoiar o projeto Volante Financeiro.';
            const whatsappUrl = `https://wa.me/5567999999999?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        }

        // Carregar logos salvos
        function loadSavedLogos() {
            const appLogo = localStorage.getItem('volante_app_logo');
            if (appLogo) {
                const adminPreview = document.getElementById('adminAppLogoPreview');
                const appDisplay = document.getElementById('appLogoDisplay');
                
                if (adminPreview) {
                    adminPreview.innerHTML = `<img src="${appLogo}" alt="Logo" class="w-full h-full object-cover rounded-full">`;
                }
                if (appDisplay) {
                    appDisplay.innerHTML = `<img src="${appLogo}" alt="Logo" class="w-full h-full object-cover rounded-full">`;
                }
            }

            const devLogo = localStorage.getItem('volante_dev_logo');
            if (devLogo) {
                const devPreview = document.getElementById('devLogoPreview');
                if (devPreview) {
                    devPreview.innerHTML = `<img src="${devLogo}" alt="Logo Desenvolvedor" class="w-full h-full object-cover rounded-lg">`;
                }
            }

            const aboutLogo = localStorage.getItem('volante_about_logo');
            if (aboutLogo) {
                const aboutPreview = document.getElementById('aboutLogoPreview');
                const aboutPageLogo = document.getElementById('aboutPageLogo');
                
                if (aboutPreview) {
                    aboutPreview.innerHTML = `<img src="${aboutLogo}" alt="Logo Sobre" class="w-full h-full object-cover rounded-full">`;
                }
                if (aboutPageLogo) {
                    aboutPageLogo.innerHTML = `<img src="${aboutLogo}" alt="Logo Volante Financeiro" class="w-full h-full object-cover rounded-full">`;
                }
            }
        }

        // Carregar configura√ß√µes de contato
        function loadContactSettings() {
            const contactSettings = JSON.parse(localStorage.getItem('volante_contact_settings') || '{}');
            
            if (contactSettings.email) {
                const emailField = document.getElementById('contactEmail');
                if (emailField) emailField.value = contactSettings.email;
            }
            
            if (contactSettings.whatsapp) {
                const whatsappField = document.getElementById('contactWhatsapp');
                if (whatsappField) whatsappField.value = contactSettings.whatsapp;
            }
            
            if (contactSettings.supporterMessage) {
                const messageField = document.getElementById('supporterMessage');
                if (messageField) messageField.value = contactSettings.supporterMessage;
            }
        }

        // Sistema de Notifica√ß√µes
        function showNotification(message, type = 'success', duration = 3000) {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                warning: 'bg-yellow-500',
                info: 'bg-blue-500'
            };
            
            notification.className = `${colors[type]} text-white px-6 py-3 rounded-lg shadow-lg transform transition-all duration-300 translate-x-full opacity-0`;
            notification.innerHTML = `
                <div class="flex items-center justify-between">
                    <span>${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-white hover:text-gray-200">
                        ‚úï
                    </button>
                </div>
            `;
            
            container.appendChild(notification);
            
            // Animar entrada
            setTimeout(() => {
                notification.classList.remove('translate-x-full', 'opacity-0');
            }, 100);
            
            // Auto remover
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.classList.add('translate-x-full', 'opacity-0');
                    setTimeout(() => {
                        if (notification.parentElement) {
                            notification.remove();
                        }
                    }, 300);
                }
            }, duration);
        }

        // Fun√ß√µes de Exporta√ß√£o
        function setQuickPeriod(period) {
            const today = new Date();
            const startDate = document.getElementById('exportStartDate');
            const endDate = document.getElementById('exportEndDate');
            
            if (period === 'month') {
                const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
                const lastDay = new Date(today.getFullYear(), today.getMonth() + 1, 0);
                startDate.value = firstDay.toISOString().split('T')[0];
                endDate.value = lastDay.toISOString().split('T')[0];
            } else if (period === 'all') {
                startDate.value = '';
                endDate.value = '';
            }
            
            updateExportCounts();
        }

        function updateExportCounts() {
            if (!currentUser) return;
            
            const startDate = document.getElementById('exportStartDate')?.value;
            const endDate = document.getElementById('exportEndDate')?.value;
            
            const userEarnings = filterDataByDateRange(earnings.filter(e => e.userId === currentUser.id), startDate, endDate);
            const userExpenses = filterDataByDateRange(expenses.filter(e => e.userId === currentUser.id), startDate, endDate);
            const userSavings = filterDataByDateRange(savings.filter(s => s.userId === currentUser.id), startDate, endDate);
            const userGoals = goals.filter(g => g.userId === currentUser.id);
            
            const earningsCountEl = document.getElementById('earningsCount');
            const expensesCountEl = document.getElementById('expensesCount');
            const savingsCountEl = document.getElementById('savingsCount');
            const goalsCountEl = document.getElementById('goalsCount');
            
            if (earningsCountEl) earningsCountEl.textContent = `${userEarnings.length} registros`;
            if (expensesCountEl) expensesCountEl.textContent = `${userExpenses.length} registros`;
            if (savingsCountEl) savingsCountEl.textContent = `${userSavings.length} registros`;
            if (goalsCountEl) goalsCountEl.textContent = `${userGoals.length} registros`;
        }

        function filterDataByDateRange(data, startDate, endDate) {
            if (!startDate && !endDate) return data;
            
            return data.filter(item => {
                const itemDate = new Date(item.date);
                const start = startDate ? new Date(startDate) : new Date('1900-01-01');
                const end = endDate ? new Date(endDate) : new Date('2100-12-31');
                
                return itemDate >= start && itemDate <= end;
            });
        }

        function exportData(type) {
            if (!currentUser) {
                showNotification('Erro: Usu√°rio n√£o logado', 'error');
                return;
            }
            
            const startDate = document.getElementById('exportStartDate')?.value;
            const endDate = document.getElementById('exportEndDate')?.value;
            
            let data, filename, headers;
            
            switch (type) {
                case 'earnings':
                    data = filterDataByDateRange(earnings.filter(e => e.userId === currentUser.id), startDate, endDate);
                    filename = `ganhos_${currentUser.name.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.csv`;
                    headers = ['Data', 'Plataforma', 'Tipo', 'Valor'];
                    data = data.map(e => [
                        new Date(e.date).toLocaleDateString('pt-BR'),
                        e.platform,
                        e.type,
                        `R$ ${e.amount.toFixed(2)}`
                    ]);
                    break;
                    
                case 'expenses':
                    data = filterDataByDateRange(expenses.filter(e => e.userId === currentUser.id), startDate, endDate);
                    filename = `despesas_${currentUser.name.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.csv`;
                    headers = ['Data', 'Categoria', 'Descri√ß√£o', 'Valor'];
                    data = data.map(e => [
                        new Date(e.date).toLocaleDateString('pt-BR'),
                        e.category,
                        e.description || '',
                        `R$ ${e.amount.toFixed(2)}`
                    ]);
                    break;
                    
                case 'savings':
                    data = filterDataByDateRange(savings.filter(s => s.userId === currentUser.id), startDate, endDate);
                    filename = `cofres_${currentUser.name.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.csv`;
                    headers = ['Data', 'Finalidade', 'Valor', 'Meta', 'Observa√ß√µes'];
                    data = data.map(s => [
                        new Date(s.date).toLocaleDateString('pt-BR'),
                        s.purpose,
                        `R$ ${s.amount.toFixed(2)}`,
                        s.goal ? `R$ ${s.goal.toFixed(2)}` : '',
                        s.notes || ''
                    ]);
                    break;
                    
                case 'goals':
                    data = goals.filter(g => g.userId === currentUser.id);
                    filename = `metas_${currentUser.name.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.csv`;
                    headers = ['Nome', 'Categoria', 'Valor Meta', 'Valor Atual', 'Data Limite', 'Status', 'Descri√ß√£o'];
                    data = data.map(g => [
                        g.name,
                        g.category,
                        `R$ ${g.amount.toFixed(2)}`,
                        `R$ ${g.currentAmount.toFixed(2)}`,
                        new Date(g.date).toLocaleDateString('pt-BR'),
                        g.completed ? 'Conclu√≠da' : 'Em andamento',
                        g.description || ''
                    ]);
                    break;
                    
                case 'complete':
                    generateCompleteReport();
                    return;
                    
                case 'backup':
                    generateBackup();
                    return;
                    
                default:
                    showNotification('Tipo de exporta√ß√£o inv√°lido', 'error');
                    return;
            }
            
            if (data.length === 0) {
                showNotification('Nenhum dado encontrado para exportar', 'warning');
                return;
            }
            
            downloadCSV([headers, ...data], filename);
            showNotification(`${data.length} registros exportados com sucesso!`, 'success');
        }

        function downloadCSV(data, filename) {
            const csvContent = data.map(row => 
                row.map(field => `"${field}"`).join(',')
            ).join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', filename);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }

        function generateCompleteReport() {
            if (!currentUser) return;
            
            const startDate = document.getElementById('exportStartDate')?.value;
            const endDate = document.getElementById('exportEndDate')?.value;
            
            const userEarnings = filterDataByDateRange(earnings.filter(e => e.userId === currentUser.id), startDate, endDate);
            const userExpenses = filterDataByDateRange(expenses.filter(e => e.userId === currentUser.id), startDate, endDate);
            const userSavings = filterDataByDateRange(savings.filter(s => s.userId === currentUser.id), startDate, endDate);
            
            const totalEarnings = userEarnings.reduce((sum, e) => sum + e.amount, 0);
            const totalExpenses = userExpenses.reduce((sum, e) => sum + e.amount, 0);
            const totalSavings = userSavings.reduce((sum, s) => sum + s.amount, 0);
            const netProfit = totalEarnings - totalExpenses - totalSavings;
            
            const period = startDate && endDate ? 
                `${new Date(startDate).toLocaleDateString('pt-BR')} a ${new Date(endDate).toLocaleDateString('pt-BR')}` :
                'Todo o per√≠odo';
            
            const reportContent = `
RELAT√ìRIO FINANCEIRO COMPLETO
Usu√°rio: ${currentUser.name}
Per√≠odo: ${period}
Gerado em: ${new Date().toLocaleString('pt-BR')}

========================================

RESUMO FINANCEIRO:
- Total de Ganhos: R$ ${totalEarnings.toFixed(2)}
- Total de Despesas: R$ ${totalExpenses.toFixed(2)}
- Total em Cofres: R$ ${totalSavings.toFixed(2)}
- Lucro L√≠quido: R$ ${netProfit.toFixed(2)}

========================================

GANHOS POR PLATAFORMA:
${getEarningsByPlatform(userEarnings)}

DESPESAS POR CATEGORIA:
${getExpensesByCategory(userExpenses)}

COFRES POR FINALIDADE:
${getSavingsByPurpose(userSavings)}

========================================
Relat√≥rio gerado pelo Volante Financeiro
            `.trim();
            
            const blob = new Blob([reportContent], { type: 'text/plain;charset=utf-8;' });
            const link = document.createElement('a');
            const filename = `relatorio_completo_${currentUser.name.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.txt`;
            
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Relat√≥rio completo gerado com sucesso!', 'success');
        }

        function getEarningsByPlatform(earnings) {
            const byPlatform = earnings.reduce((acc, e) => {
                acc[e.platform] = (acc[e.platform] || 0) + e.amount;
                return acc;
            }, {});
            
            return Object.entries(byPlatform)
                .map(([platform, amount]) => `- ${platform}: R$ ${amount.toFixed(2)}`)
                .join('\n') || 'Nenhum ganho registrado';
        }

        function getExpensesByCategory(expenses) {
            const byCategory = expenses.reduce((acc, e) => {
                acc[e.category] = (acc[e.category] || 0) + e.amount;
                return acc;
            }, {});
            
            return Object.entries(byCategory)
                .map(([category, amount]) => `- ${category}: R$ ${amount.toFixed(2)}`)
                .join('\n') || 'Nenhuma despesa registrada';
        }

        function getSavingsByPurpose(savings) {
            const byPurpose = savings.reduce((acc, s) => {
                acc[s.purpose] = (acc[s.purpose] || 0) + s.amount;
                return acc;
            }, {});
            
            return Object.entries(byPurpose)
                .map(([purpose, amount]) => `- ${purpose}: R$ ${amount.toFixed(2)}`)
                .join('\n') || 'Nenhuma reserva registrada';
        }

        function generateBackup() {
            if (!currentUser) return;
            
            const backupData = {
                version: '1.0',
                timestamp: new Date().toISOString(),
                user: currentUser,
                data: {
                    earnings: earnings.filter(e => e.userId === currentUser.id),
                    expenses: expenses.filter(e => e.userId === currentUser.id),
                    savings: savings.filter(s => s.userId === currentUser.id),
                    goals: goals.filter(g => g.userId === currentUser.id)
                },
                settings: {
                    contact: JSON.parse(localStorage.getItem('volante_contact_settings') || '{}'),
                    about: JSON.parse(localStorage.getItem('volante_about_info') || '{}')
                }
            };
            
            const blob = new Blob([JSON.stringify(backupData, null, 2)], { type: 'application/json' });
            const link = document.createElement('a');
            const filename = `backup_volante_${currentUser.name.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.json`;
            
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Backup criado com sucesso!', 'success');
        }

        function importBackup() {
            const fileInput = document.getElementById('importBackup');
            const file = fileInput.files[0];
            
            if (!file) {
                showNotification('Selecione um arquivo de backup', 'warning');
                return;
            }
            
            if (!confirm('‚ö†Ô∏è ATEN√á√ÉO: Importar um backup substituir√° TODOS os seus dados atuais. Esta a√ß√£o n√£o pode ser desfeita. Deseja continuar?')) {
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const backupData = JSON.parse(e.target.result);
                    
                    if (!backupData.version || !backupData.data) {
                        throw new Error('Arquivo de backup inv√°lido');
                    }
                    
                    // Restaurar dados
                    const userId = currentUser.id;
                    
                    // Remover dados atuais do usu√°rio
                    earnings = earnings.filter(e => e.userId !== userId);
                    expenses = expenses.filter(e => e.userId !== userId);
                    savings = savings.filter(s => s.userId !== userId);
                    goals = goals.filter(g => g.userId !== userId);
                    
                    // Adicionar dados do backup
                    earnings.push(...backupData.data.earnings.map(e => ({...e, userId})));
                    expenses.push(...backupData.data.expenses.map(e => ({...e, userId})));
                    savings.push(...backupData.data.savings.map(s => ({...s, userId})));
                    goals.push(...backupData.data.goals.map(g => ({...g, userId})));
                    
                    // Salvar no localStorage
                    localStorage.setItem('volante_earnings', JSON.stringify(earnings));
                    localStorage.setItem('volante_expenses', JSON.stringify(expenses));
                    localStorage.setItem('volante_savings', JSON.stringify(savings));
                    localStorage.setItem('volante_goals', JSON.stringify(goals));
                    
                    // Restaurar configura√ß√µes se existirem
                    if (backupData.settings?.contact) {
                        localStorage.setItem('volante_contact_settings', JSON.stringify(backupData.settings.contact));
                    }
                    if (backupData.settings?.about) {
                        localStorage.setItem('volante_about_info', JSON.stringify(backupData.settings.about));
                    }
                    
                    // Atualizar interface
                    updateDashboard();
                    
                    showNotification('Backup importado com sucesso!', 'success');
                    fileInput.value = '';
                    
                } catch (error) {
                    console.error('Erro ao importar backup:', error);
                    showNotification('Erro ao importar backup: arquivo inv√°lido', 'error');
                }
            };
            
            reader.readAsText(file);
        }

        // Fun√ß√µes de Busca e Filtro
        function filterEarnings() {
            const searchTerm = document.getElementById('searchEarnings').value.toLowerCase();
            const platformFilter = document.getElementById('filterEarningsPlatform').value;
            
            const userEarnings = earnings.filter(e => e.userId === currentUser.id);
            
            const filteredEarnings = userEarnings.filter(earning => {
                const matchesSearch = !searchTerm || 
                    earning.platform.toLowerCase().includes(searchTerm) ||
                    earning.type.toLowerCase().includes(searchTerm) ||
                    earning.amount.toString().includes(searchTerm);
                
                const matchesPlatform = !platformFilter || earning.platform === platformFilter;
                
                return matchesSearch && matchesPlatform;
            });
            
            displayFilteredEarnings(filteredEarnings);
        }

        function displayFilteredEarnings(filteredEarnings) {
            const list = document.getElementById('earningsList');
            
            if (filteredEarnings.length === 0) {
                list.innerHTML = '<p class="text-gray-500">Nenhum ganho encontrado com os filtros aplicados.</p>';
                return;
            }

            list.innerHTML = filteredEarnings.slice(-10).reverse().map(earning => `
                <div class="flex justify-between items-center p-3 bg-green-50 rounded-lg">
                    <div>
                        <p class="font-semibold">${earning.platform} - ${earning.type}</p>
                        <p class="text-sm text-gray-600">${new Date(earning.date).toLocaleDateString('pt-BR')}</p>
                    </div>
                    <div class="flex items-center space-x-2">
                        <span class="font-bold text-green-600">R$ ${earning.amount.toFixed(2)}</span>
                        <button onclick="editEarning(${earning.id})" class="text-blue-600 hover:text-blue-800 text-sm">
                            ‚úèÔ∏è
                        </button>
                        <button onclick="deleteEarning(${earning.id})" class="text-red-600 hover:text-red-800 text-sm">
                            üóëÔ∏è
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function filterExpenses() {
            const searchTerm = document.getElementById('searchExpenses').value.toLowerCase();
            const categoryFilter = document.getElementById('filterExpensesCategory').value;
            
            const userExpenses = expenses.filter(e => e.userId === currentUser.id);
            
            const filteredExpenses = userExpenses.filter(expense => {
                const matchesSearch = !searchTerm || 
                    expense.category.toLowerCase().includes(searchTerm) ||
                    (expense.description && expense.description.toLowerCase().includes(searchTerm)) ||
                    expense.amount.toString().includes(searchTerm);
                
                const matchesCategory = !categoryFilter || expense.category === categoryFilter;
                
                return matchesSearch && matchesCategory;
            });
            
            displayFilteredExpenses(filteredExpenses);
        }

        function displayFilteredExpenses(filteredExpenses) {
            const list = document.getElementById('expensesList');
            
            if (filteredExpenses.length === 0) {
                list.innerHTML = '<p class="text-gray-500">Nenhuma despesa encontrada com os filtros aplicados.</p>';
                return;
            }

            list.innerHTML = filteredExpenses.slice(-10).reverse().map(expense => `
                <div class="flex justify-between items-center p-3 bg-red-50 rounded-lg">
                    <div>
                        <p class="font-semibold">${expense.category}</p>
                        <p class="text-sm text-gray-600">${expense.description || 'Sem descri√ß√£o'}</p>
                        <p class="text-xs text-gray-500">${new Date(expense.date).toLocaleDateString('pt-BR')}</p>
                    </div>
                    <div class="flex items-center space-x-2">
                        <span class="font-bold text-red-600">R$ ${expense.amount.toFixed(2)}</span>
                        <button onclick="editExpense(${expense.id})" class="text-blue-600 hover:text-blue-800 text-sm">
                            ‚úèÔ∏è
                        </button>
                        <button onclick="deleteExpense(${expense.id})" class="text-red-600 hover:text-red-800 text-sm">
                            üóëÔ∏è
                        </button>
                    </div>
                </div>
            `).join('');
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9755efd7d3fa3252',t:'MTc1NjIzODY1Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
